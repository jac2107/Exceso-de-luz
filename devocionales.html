<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devocionales - Exceso de Luz</title>
    <link rel="stylesheet" href="exceso_de_luz.css">
    <style>
        .home-minimal {
            position: fixed;
            top: 18px; left: 18px;
            font-size: 0.85rem; font-weight: 500;
            color: rgba(0,0,0,0.85);
            text-decoration: none;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(6px);
            padding: 8px 14px;
            border-radius: 999px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            opacity: 0; pointer-events: none;
            transform: translateY(-6px);
            transition: opacity .25s ease, transform .25s ease, box-shadow .25s ease;
            z-index: 999;
        }
        .home-minimal.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .home-minimal:hover { background: rgba(255,248,235,0.95); box-shadow: 0 10px 24px rgba(0,0,0,0.18); }
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           CONTROLES Y FILTROS
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .devotional-controls {
            background: var(--bg-card);
            padding: clamp(1.5rem, 3vw, 2rem);
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .filter-dropdown {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .filter-btn-toggle {
            width: 100%;
            padding: 0.8rem 3rem 0.8rem 1rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .filter-btn-toggle:hover {
            border-color: var(--primary-color);
        }

        .filter-btn-toggle.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .filter-btn-toggle::after {
            content: '‚ñº';
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .filter-btn-toggle.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .filter-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 280px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .filter-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .filter-option {
            padding: 0.7rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: var(--color-beige);
        }

        .filter-option.selected {
            background: linear-gradient(135deg, 
                rgba(215, 204, 200, 0.3) 0%, 
                rgba(239, 235, 233, 0.2) 100%);
            font-weight: 600;
        }

        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            user-select: none;
        }

        .sort-select {
            padding: 0.7rem 2rem 0.7rem 0.8rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.6rem center;
            min-width: 180px;
            flex-shrink: 0;
        }

        .sort-select:hover {
            border-color: var(--primary-color);
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .active-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            min-height: 24px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary-color);
            color: var(--color-blanco);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: chipIn 0.3s ease;
        }

        @keyframes chipIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .filter-chip-close {
            cursor: pointer;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .filter-chip-close:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.8rem;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           TARJETAS DE DEVOCIONAL
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .devotional-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s ease;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .devotional-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 35px rgba(93, 64, 55, 0.25);
        }

        /* Imagen del devocional */
        .devotional-image {
            position: relative;
            width: 100%;
            padding-top: 65%;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            overflow: hidden;
        }

        .devotional-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .devotional-card:hover .devotional-image img {
            transform: scale(1.05);
        }

        /* Duraci√≥n del plan */
        .devotional-duration {
            position: absolute;
            top: 6px;
            left: 6px;
            padding: 0.3rem 0.3rem;
            background: rgba(0,0,0,0.85);
            color: white;
            border-radius: 20px;
            font-size: 0.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .devotional-duration i {
            font-size: 0.7rem;
        }

        /* Categor√≠a */
        .devotional-category {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 0.4rem 0.1rem;
            background: rgba(255,255,255,0.95);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
        }

        /* Stats */
        .devotional-stats {
            position: absolute;
            bottom: 6px;
            right: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0,0,0,0.75);
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 8px;
            z-index: 10;
        }

        .devotional-stats i {
            font-size: 10px;
            color: #ffffff;
        }

        .devotional-stat-number {
            font-weight: 700;
            color: white;
        }

        /* Informaci√≥n del devocional */
        .devotional-info {
            padding: 1.3rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .devotional-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 0.6rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .devotional-synopsis {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }

        /* Acciones */
        .devotional-actions {
            display: flex;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }

        .devotional-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            
        }

        .btn-go {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .btn-go:hover {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn-info-dev {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(156, 39, 176, 0.3);
        }

        .btn-info-dev:hover {
            background: linear-gradient(135deg, #7B1FA2 0%, #6A1B9A 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.4);
        }

        /* Checkbox completado */
        .checkbox-wrapper-devotional {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .checkbox-wrapper-devotional input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success-color);
        }

        .checkbox-wrapper-devotional label {
            font-size: 0.88rem;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            font-weight: 500;
        }

        .checkbox-wrapper-devotional input:checked + label {
            color: var(--success-color);
            font-weight: 600;
        }

        /* Badge completado */
        .completed-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.4rem;
            z-index: 15;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            animation: badgePop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes badgePop {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.3) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* Tarjeta completada */
        .devotional-card.completed {
            opacity: 0.75;
            border-color: var(--success-color);
            
        }

        .devotional-card.completed::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.15) 0%, 
                rgba(56, 142, 60, 0.1) 100%);
            border-radius: 16px;
            pointer-events: none;
            z-index: 1;
        }

      

        /* Modal de sinopsis */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            max-width: 650px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: var(--bg-main);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--primary-color);
            color: white;
            transform: rotate(90deg);
        }

        .modal-devotional-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--text-primary);
        }

        .modal-devotional-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .modal-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.9rem;
            background: var(--bg-main);
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .modal-meta-item i {
            color: var(--primary-color);
        }

        .modal-devotional-synopsis {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .filter-section {
                flex-direction: column;
            }
            
            .filter-dropdown,
            .sort-select {
                min-width: 100%;
            }

            .devotional-title {
                font-size: 1.05rem;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }
 
        }
        /* ==========================
   GRID RESPONSIVE (libros / devocionales)
   ========================== */

.resource-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(4, 1fr); /* desktop amplio por defecto */
  align-items: start;
  width: 100%;
  box-sizing: border-box;
}

/* columnas seg√∫n breakpoints */
@media (max-width: 1200px) {
  .resource-grid { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 900px) {
  .resource-grid { grid-template-columns: repeat(2, 1fr); } /* 2 columnas en tablets */
}
@media (max-width: 520px) {
  .resource-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
}

/* Asegura comportamiento consistente para ambas tarjetas */
.book-card,
.devotional-card {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 340px;
  box-sizing: border-box;
  position: relative; /* para overlays/badges */
}

/* Contenedores de portada (mapeo para book/devotional) */
.book-cover-wrapper,
.devotional-image {
  flex: 0 0 auto;
  width: 100%;
}

/* Info siempre en pie para mantener acciones alineadas */
.book-info,
.devotional-info {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  box-sizing: border-box;
}

/* ajustes internos comunes */
.book-title, .devotional-title { margin-bottom: 0.5rem; }
.book-synopsis, .devotional-synopsis { margin-bottom: 1rem; }
.book-btn, .devotional-btn { white-space: nowrap; }

/* portada: ensure cover works nicely */
.book-cover-art,
.devotional-image img {
  background-size: cover;
  background-position: center center;
  border-radius: 8px;
}

/* Stats peque√±os responsive */
.book-stats, .devotional-stats { font-size: 12px; padding: 6px 8px; }
.book-stat-number, .devotional-stat-number { font-size: 11px; }

/* Tarjeta completada: estilo opcional */
.book-card.completed,
.devotional-card.completed {
  filter: grayscale(40%) brightness(0.92);
}
.book-card.completed::after,
.devotional-card.completed::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 16px;
  pointer-events: none;
  background: rgba(0,0,0,0.16);
}

/* ==========================
   PANEL DE FILTROS (ocultar en scroll + bot√≥n)
   ========================== */

/* Mant√©n sticky; se ocultar√° con la clase .hidden */
.books-controls,
.devotional-controls {
  position: sticky;
  top: 0;
  z-index: 100;
  transition: transform .32s cubic-bezier(.22,.9,.32,1), opacity .28s ease;
  will-change: transform, opacity;
}

/* clase aplicada por scroll para esconder */
.books-controls.hidden,
.devotional-controls.hidden {
  transform: translateY(-120%);
  opacity: 0;
  pointer-events: none;
}

/* clase forzada por toggle del bot√≥n para mostrar manualmente */
.books-controls.shown-manual,
.devotional-controls.shown-manual {
  transform: translateY(0) !important;
  opacity: 1 !important;
  pointer-events: auto !important;
  animation: slideDownFade 320ms cubic-bezier(.22,.9,.32,1) both;
}

/* evita que filtros ocupen toda la pantalla en m√≥vil */
@media (max-width: 520px) {
  .filter-menu { max-height: 50vh; }
  .filter-section { gap: .5rem; }
  .filter-dropdown { min-width: 140px; }
}

/* ==========================
   BOTONES FLOTANTES (filtros + back-to-top)
   ========================== */

.filters-toggle {
  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 1200;
  display: none;
  align-items: center;
  gap: .6rem;
  background: var(--bg-card);
  color: var(--text-primary);
  border: none;
  padding: 10px 12px;
  border-radius: 999px;
  box-shadow: 0 8px 28px rgba(8,12,20,0.12);
  cursor: pointer;
  font-weight: 700;
  font-size: 0.9rem;
}

/* mostrar el bot√≥n en pantallas < 900px */
@media (max-width: 900px) {
  .filters-toggle { display: inline-flex; }
  main .container { padding-top: 0.5rem; } /* espacio cuando el panel est√° oculto */
}

/* Back to top */
.back-to-top {
  position: fixed;
  right: 18px;
  bottom: 82px;
  z-index: 1300;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .5rem;
  background: var(--bg-card);
  color: var(--text-primary);
  border: none;
  padding: 10px 10px;
  border-radius: 999px;
  box-shadow: 0 10px 28px rgba(8,12,20,0.12);
  cursor: pointer;
  font-weight: 700;
  transform: translateY(8px) scale(.98);
  opacity: 0;
  pointer-events: none;
  transition: transform .28s ease, opacity .28s ease;
}
.back-to-top.visible {
  transform: translateY(0) scale(1);
  opacity: 1;
  pointer-events: auto;
}
@media (max-width: 420px) {
  .back-to-top { right: 12px; bottom: 70px; padding: 8px 14px; font-size: 1.05rem; }
  .filters-toggle { right: 12px; bottom: 18px; }
}
.filters-toggle:focus, .back-to-top:focus {
  outline: 3px solid rgba(0,0,0,0.07);
  outline-offset: 3px;
}

/* ==========================
   ANIMACIONES (slide)
   ========================== */
@keyframes slideDownFade {
  from { transform: translateY(-14px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}
@keyframes slideUpFade {
  from { transform: translateY(0); opacity: 1; }
  to   { transform: translateY(-14px); opacity: 0; }
}

/* ==========================
   AJUSTES FINALES DE RESPONSIVE
   ========================== */
@media (max-width: 520px) {
  .resource-grid { grid-template-columns: repeat(2, 1fr); gap: 0.7rem; }
  .book-cover-wrapper { padding-top: 160%; }
  .book-3d { width: 90%; height: 88%; }
  .devotional-image { padding-top: 72%; } /* imagen m√°s vertical si es devocional */
}/* ==========================
   GRID RESPONSIVE (libros / devocionales)
   ========================== */

.resource-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(4, 1fr); /* desktop amplio por defecto */
  align-items: start;
  width: 100%;
  box-sizing: border-box;
}

/* columnas seg√∫n breakpoints */
@media (max-width: 1200px) {
  .resource-grid { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 900px) {
  .resource-grid { grid-template-columns: repeat(2, 1fr); } /* 2 columnas en tablets */
}
@media (max-width: 520px) {
  .resource-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
}

/* Asegura comportamiento consistente para ambas tarjetas */
.book-card,
.devotional-card {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 340px;
  box-sizing: border-box;
  position: relative; /* para overlays/badges */
}

/* Contenedores de portada (mapeo para book/devotional) */
.book-cover-wrapper,
.devotional-image {
  flex: 0 0 auto;
  width: 100%;
}

/* Info siempre en pie para mantener acciones alineadas */
.book-info,
.devotional-info {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  box-sizing: border-box;
}

/* ajustes internos comunes */
.book-title, .devotional-title { margin-bottom: 0.5rem; }
.book-synopsis, .devotional-synopsis { margin-bottom: 1rem; }
.book-btn, .devotional-btn { white-space: nowrap; }

/* portada: ensure cover works nicely */
.book-cover-art,
.devotional-image img {
  background-size: cover;
  background-position: center center;
  border-radius: 8px;
}

/* Stats peque√±os responsive */
.book-stats, .devotional-stats { font-size: 12px; padding: 6px 8px; }
.book-stat-number, .devotional-stat-number { font-size: 11px; }

/* Tarjeta completada: estilo opcional */
.book-card.completed,
.devotional-card.completed {
  filter: grayscale(40%) brightness(0.92);
}
.book-card.completed::after,
.devotional-card.completed::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 16px;
  pointer-events: none;
  background: rgba(0,0,0,0.16);
}

/* ==========================
   PANEL DE FILTROS (ocultar en scroll + bot√≥n)
   ========================== */

/* Mant√©n sticky; se ocultar√° con la clase .hidden */
.books-controls,
.devotional-controls {
  position: sticky;
  top: 0;
  z-index: 100;
  transition: transform .32s cubic-bezier(.22,.9,.32,1), opacity .28s ease;
  will-change: transform, opacity;
}

/* clase aplicada por scroll para esconder */
.books-controls.hidden,
.devotional-controls.hidden {
  transform: translateY(-120%);
  opacity: 0;
  pointer-events: none;
}

/* clase forzada por toggle del bot√≥n para mostrar manualmente */
.books-controls.shown-manual,
.devotional-controls.shown-manual {
  transform: translateY(0) !important;
  opacity: 1 !important;
  pointer-events: auto !important;
  animation: slideDownFade 320ms cubic-bezier(.22,.9,.32,1) both;
}

/* evita que filtros ocupen toda la pantalla en m√≥vil */
@media (max-width: 520px) {
  .filter-menu { max-height: 50vh; }
  .filter-section { gap: .5rem; }
  .filter-dropdown { min-width: 140px; }
}

/* ==========================
   BOTONES FLOTANTES (filtros + back-to-top)
   ========================== */

.filters-toggle {
  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 1200;
  display: none;
  align-items: center;
  gap: .6rem;
  background: var(--bg-card);
  color: var(--text-primary);
  border: none;
  padding: 10px 12px;
  border-radius: 999px;
  box-shadow: 0 8px 28px rgba(8,12,20,0.12);
  cursor: pointer;
  font-weight: 700;
  font-size: 0.9rem;
}

/* mostrar el bot√≥n en pantallas < 900px */
@media (max-width: 900px) {
  .filters-toggle { display: inline-flex; }
  main .container { padding-top: 0.5rem; } /* espacio cuando el panel est√° oculto */
}

/* Back to top */
.back-to-top {
  position: fixed;
  right: 18px;
  bottom: 82px;
  z-index: 1300;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .5rem;
  background: var(--bg-card);
  color: var(--text-primary);
  border: none;
  padding: 10px 10px;
  border-radius: 999px;
  box-shadow: 0 10px 28px rgba(8,12,20,0.12);
  cursor: pointer;
  font-weight: 700;
  transform: translateY(8px) scale(.98);
  opacity: 0;
  pointer-events: none;
  transition: transform .28s ease, opacity .28s ease;
}
.back-to-top.visible {
  transform: translateY(0) scale(1);
  opacity: 1;
  pointer-events: auto;
}
@media (max-width: 420px) {
  .back-to-top { right: 12px; bottom: 70px; padding: 8px 14px; font-size: 1.05rem; }
  .filters-toggle { right: 12px; bottom: 18px; }
}
.filters-toggle:focus, .back-to-top:focus {
  outline: 3px solid rgba(0,0,0,0.07);
  outline-offset: 3px;
}

/* ==========================
   ANIMACIONES (slide)
   ========================== */
@keyframes slideDownFade {
  from { transform: translateY(-14px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}
@keyframes slideUpFade {
  from { transform: translateY(0); opacity: 1; }
  to   { transform: translateY(-14px); opacity: 0; }
}

/* ==========================
   AJUSTES FINALES DE RESPONSIVE
   ========================== */
@media (max-width: 520px) {
  .resource-grid { grid-template-columns: repeat(2, 1fr); gap: 0.7rem; }
  .book-cover-wrapper { padding-top: 160%; }
  .book-3d { width: 90%; height: 88%; }
  .devotional-image { padding-top: 72%; } /* imagen m√°s vertical si es devocional */
}
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none;">
                    <h1>‚ú® Exceso de Luz</h1>
                    <p class="tagline">Ilumina tu camino espiritual</p>
                </a>
            </div>
            <a href="index.html" class="btn-back">‚Üê Volver</a>
        </div>
    </header>

    <main class="main-container">
        <div class="container">
            <div class="page-header">
                <div class="page-icon">üìñ</div>
                <h2>Devocionales Diarios</h2>
                <p>Reflexiones y meditaciones para nutrir tu alma cada d√≠a</p>
            </div>

            <div class="devotional-controls">
                <div class="filter-section">
                    <div class="filter-dropdown">
                        <button class="filter-btn-toggle" id="categoria-toggle">
                            Categor√≠a (todas)
                        </button>
                        <div class="filter-menu" id="categoria-menu"></div>
                    </div>

                    <div class="filter-dropdown">
                        <button class="filter-btn-toggle" id="duracion-toggle">
                            Duraci√≥n (todas)
                        </button>
                        <div class="filter-menu" id="duracion-menu"></div>
                    </div>

                    <select id="sort-select" class="sort-select">
                        <option value="default">Por defecto</option>
                        <option value="most-completed">‚úÖ M√°s completados</option>
                        <option value="most-started">üöÄ M√°s iniciados</option>
                    </select>
                </div>

                <div class="active-filters" id="active-filters"></div>
                <div class="results-count" id="results-count"></div>
            </div>

            <div class="resource-grid" id="devocionales-grid"></div>
        </div>
    </main>

    <!-- Modal de sinopsis -->
    <div class="modal-overlay" id="modal-synopsis">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">√ó</button>
            <h3 class="modal-devotional-title" id="modal-title"></h3>
            <div class="modal-devotional-meta" id="modal-meta"></div>
            <p class="modal-devotional-synopsis" id="modal-synopsis-text"></p>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Exceso de Luz</p>
            <p class="verse">"L√°mpara es a mis pies tu palabra" ‚Äî Salmos 119:105</p>
        </div>
    </footer>
    
    <script src="exceso_de_luz.js"></script>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyARYSgelNGVVpOryuq0Z3YCZxoqYA8TUns",
  authDomain: "exceso-de-luz.firebaseapp.com",
  projectId: "exceso-de-luz",
  storageBucket: "exceso-de-luz.firebasestorage.app",
  messagingSenderId: "442481525938",
  appId: "1:442481525938:web:e72a2672a589e594aeb5ab",
  measurementId: "G-GLTKTGY2GG"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window._devotionalStatsCache = window._devotionalStatsCache || {};

window.registrarInicioDevocional = async function(devocionalId) {
  try {
    const devRef = doc(db, 'devocionales', devocionalId);
    await setDoc(devRef, {
      iniciados: increment(1),
      ultimoInicio: new Date()
    }, { merge: true });
    console.log('‚úÖ Inicio registrado:', devocionalId);
  } catch(err) {
    console.error('‚ùå Error registrarInicio', err);
  }
};

window.registrarCompletadoDevocional = async function(devocionalId) {
  try {
    const devRef = doc(db, 'devocionales', devocionalId);
    await setDoc(devRef, {
      completados: increment(1),
      ultimoCompletado: new Date()
    }, { merge: true });
    console.log('‚úÖ Completado registrado:', devocionalId);
  } catch(err) {
    console.error('‚ùå Error registrarCompletado', err);
  }
};
window.desregistrarCompletadoDevocional = async function(devocionalId) {
  try {
    const devRef = doc(db, 'devocionales', devocionalId);
    await setDoc(devRef, {
      completados: increment(-1)
    }, { merge: true });
    console.log('‚úÖ Completado removido:', devocionalId);
  } catch(err) {
    console.error('‚ùå Error desregistrarCompletado', err);
  }
};
window.escucharCambiosDevocional = function(devocionalId, callback) {
  const devRef = doc(db, 'devocionales', devocionalId);
  onSnapshot(devRef, snap => {
    const data = snap.exists() ? snap.data() : {};
    const stats = {
      iniciados: data.iniciados || 0,
      completados: data.completados || 0
    };
    window._devotionalStatsCache[devocionalId] = stats;
    callback(stats);
  }, err => console.error('‚ùå snapshot error', err));
};

console.log('üî• Firebase devocionales stats ready');
</script>
    <script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATOS DE DEVOCIONALES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const devocionalesData = [
    {
        id: 'd1',
        titulo: 'La Nueva Era de la Esclavitud: Rompiendo Cadenas Invisibles',
        categoria: 'Sanidad y Transformaci√≥n',
        duracion: '5 d√≠as',
        dias: 5,
        sinopsis: 'Ya no hay grilletes de hierro, pero seguimos siendo esclavos. Hoy, nuestras cadenas se llaman ansiedad, aprobaci√≥n, deuda y distracci√≥n. En este plan de 5 d√≠as, basado en el libro "La Nueva Era de la Esclavitud", Roell Morales nos gu√≠a a trav√©s de las Escrituras para identificar estos yugos modernos y redescubrir la libertad radical que Cristo compr√≥ para nosotros.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67806%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67806-la-nueva-era-de-la-esclavitud-rompiendo-c'
    },
    {
        id: 'd2',
        titulo: 'Reescribe Tu Historia. 7 Pasos Para Dejar Atr√°s Tu Vieja Vida',
        categoria: 'Sanidad y Transformaci√≥n',
        duracion: '7 d√≠as',
        dias: 7,
        sinopsis: 'Este plan es una invitaci√≥n a mirar tu pasado con esperanza, a confiar en el poder transformador de Jes√∫s y a avanzar con una fe renovada. A lo largo de siete d√≠as descubrir√°s que tu historia no est√° determinada por tus errores, sino por la gracia de Dios, que sana, restaura y abre caminos nuevos. Cada d√≠a te anima a soltar lo que te ata, abrazar la cruz y caminar hacia adelante con valent√≠a y prop√≥sito.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67809%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67809-reescribe-tu-historia-7-pasos-para-dejar-atras-'
    },
    {
        id: 'd3',
        titulo: 'Caminar Como Disc√≠pulos',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '3 d√≠as',
        dias: 3,
        sinopsis: 'Caminar como disc√≠pulos es una serie devocional que nos llama a vivir el discipulado de manera pr√°ctica y personal. A trav√©s de tres d√≠as, aprendemos que seguir a Jes√∫s implica amar a Dios y a las personas, comprometernos con una fe constante y compartir lo que √âl hizo en nosotros. El discipulado comienza en el coraz√≥n, se vive en decisiones diarias y se multiplica cuando caminamos con otros. Es una invitaci√≥n a pasar de solo creer a vivir como verdaderos disc√≠pulos de Jes√∫s.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67144%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67144-caminar-como-discipulos'
    },
    {
        id: 'd4',
        titulo: 'Mujer Ideal Y Virtuosa.',
        categoria: 'Temas Espec√≠ficos',
        duracion: '14 d√≠as',
        dias: 14,
        sinopsis: 'En esta lectura estudiaremos, este vers√≠culo, ya que nos introduce y elogia a la "mujer virtuosa" o "ejemplar", declarando que su valor es extremadamente raro y precioso, superando con creces el de las joyas o piedras preciosas (como los rub√≠es).',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F66917%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/66917-mujer-ideal-y-virtuosa'
    },
    {
        id: 'd5',
        titulo: 'El Dios No Conocido',
        categoria: 'Naturaleza y Car√°cter de Dios',
        duracion: '7 d√≠as',
        dias: 7,
        sinopsis: 'Este plan de lectura de 7 d√≠as te guiar√° a conocer al Dios que muchos adoran sin conocer verdaderamente. A trav√©s de la vida del profeta Samuel y pasajes clave de las Escrituras, descubrir√°s c√≥mo pasar de una fe heredada a una relaci√≥n personal con Dios. Aprender√°s a reconocer Su voz, rendir tu coraz√≥n, confrontar √≠dolos y vivir como un instrumento de Su presencia. Al finalizar este plan, experimentar√°s una fe m√°s profunda, sensible y transformadora.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67193%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67193-el-dios-no-conocido'
    },
    {
        id: 'd6',
        titulo: 'Love Like Jesus',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '13 d√≠as',
        dias: 13,
        sinopsis: '¬øC√≥mo podemos aprender a vivir como Jes√∫s si primero no amamos como √âl?',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F2391%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/2391-love-like-jesus'
    },
    {
        id: 'd7',
        titulo: 'La Iglesia Amando, Sirviendo Y Transformando',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '14 d√≠as',
        dias: 14,
        sinopsis: 'Este plan de lectura de 14 d√≠as se centra en una serie de reflexiones de ministros, pastores y l√≠deres, sobre el prop√≥sito esencial de la iglesia: Amar a Dios, Amar al pr√≥jimo y Transformar al mundo.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67996%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67996-la-iglesia-amando-sirviendo-y-transformando'
    },
    {
        id: 'd8',
        titulo: '¬°Am√©n! ¬°Am√©n! ¬°Am√©n!',
        categoria: 'Naturaleza y Car√°cter de Dios',
        duracion: '5 d√≠as',
        dias: 5,
        sinopsis: 'Este plan tiene como fin que, tomando las promesas que Dios nos da por medio de su Palabra, aprendamos a declarar las cosas que no son como si fueran.En cada reflexi√≥n se utilizan an√©cdotas o situaciones que ocurren en el diario vivir.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F21852%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/21852-amen-amen-amen'
    },
    {
        id: 'd9',
        titulo: 'El Regalo Del Perd√≥n',
        categoria: 'Sanidad y Transformaci√≥n',
        duracion: '7 d√≠as',
        dias: 7,
        sinopsis: 'El perd√≥n es un mandato del Se√±or donde su Palabra nos ense√±a que debemos poner sobre nuestra vida una base de misericordia, perd√≥n y gracia. Esto no tiene nada que ver con los sentimientos en si ‚Äúsentimos‚Äù perdonar. La vida cristiana se vive en obediencia permanente a Dios y a su Palabra. Si te cuesta perdonar o no te han perdonado de la manera correcta, este devocional es para ti.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F46913%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/46913-el-regalo-del-perdon'
    },
    {
        id: 'd10',
        titulo: 'Afilando mi espada',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '365 d√≠as',
        dias: 365,
        sinopsis: 'Este plan est√° dise√±ado para que internalices en las Escrituras, leyendo el Nuevo Testamento y algunos libros del Antiguo Testamento. A lo largo de esta traves√≠a, descubrir√°s c√≥mo ambos testamentos se conectan a trav√©s de profec√≠as, promesas y revelaciones que apuntan hacia el cumplimiento en Jes√∫s. Cada d√≠a ser√° una oportunidad para afilar tu espada espiritual, fortalecer tu fe y ganar una comprensi√≥n m√°s profunda de los principios y prop√≥sitos divinos. ¬°Prep√°rate para un recorrido transformador que enriquecer√° tu vida y tu caminar con Dios!',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F53428%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/53428-afilando-mi-espada'
    },
    {
        id: 'd11',
        titulo: 'Nombres de Dios',
        categoria: 'Naturaleza y Car√°cter de Dios',
        duracion: '14 d√≠as',
        dias: 14,
        sinopsis: 'Este plan de lectura te guiar√° por algunos de los nombres de Dios revelados en la Biblia. Cada d√≠a descubrir√°s su significado original y el contexto en que fue revelado. Reflexionar√°s sobre c√≥mo cada nombre revela un aspecto √∫nico de Su car√°cter. Aplicar√°s estas verdades a tu vida diaria. Al final, conocer√°s m√°s profundamente qui√©n es Dios y c√≥mo caminar con √âl.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F62244%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/62244-nombres-de-dios'
    },
    {
        id: 'd12',
        titulo: 'C√≥mo usar tu tiempo para Dios',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '4 d√≠as',
        dias: 4,
        sinopsis: 'Devocional de 4 d√≠as de R. C. Sproul sobre c√≥mo usar tu tiempo para Dios. Cada devocional te llama a vivir en la presencia de Dios, bajo la autoridad de Dios y para la gloria de Dios.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F26738%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/26738-como-usar-tu-tiempo-para-dios'
    },
    {
        id: 'd13',
        titulo: 'S√≠ Y Am√©n',
        categoria: 'Naturaleza y Car√°cter de Dios',
        duracion: '5 d√≠as',
        dias: 5,
        sinopsis: 'En estos cinco d√≠as vamos a meditar las palabras S√≠ y Am√©n. Vamos a descubrir c√≥mo avanzar en las √°reas donde estamos estancados.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F42587%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/42587-si-y-amen'
    },
    {
        id: 'd14',
        titulo: 'Primeros Pasos - Preguntas Y Respuestas',
        categoria: 'Introducci√≥n a la Fe',
        duracion: '10 d√≠as',
        dias: 10,
        sinopsis: 'Alguna vez te has preguntado: ¬øQu√© sucedi√≥ cuando recibiste a Cristo? ¬øPuedo estar seguro de que soy salvo? ¬øQu√© sucede si un cristianos peca? Y muchas otras m√°s. A lo largo de este devocional, podr√°s encontrar respuestas a preguntas frecuentes en la vida del nuevo creyente, a la luz de la Palabra. ¬°Sigue adelante para entender mejor acerca de tu caminar con tu Se√±or!',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F43333%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/43333-primeros-pasos-preguntas-y-respuestas'
    },
    {
        id: 'd15',
        titulo: 'Tabla de contexto',
        categoria: 'Introducci√≥n a la Fe',
        duracion: '28 d√≠as',
        dias: 28,
        sinopsis: 'Para muchos, la Biblia parece generar m√°s confusi√≥n que claridad. Como adolescente, te encuentras en una etapa de hacer preguntas, expresar dudas y debatir con la idea de la fe. Entonces, ¬øc√≥mo puedes empezar a comprender la Biblia y su contexto? Este devocional de 4 semanas te ayudar√° a entender c√≥mo las antiguas palabras de la Biblia se conectan con tu vida moderna y cotidiana.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F38954%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/38954-tabla-de-contexto'
    },
    {
        id: 'd16',
        titulo: 'Conociendo a Jes√∫s Como Tu Mejor Amigo',
        categoria: 'Introducci√≥n a la Fe',
        duracion: '3 d√≠as',
        dias: 3,
        sinopsis: '¬øQu√© significa que Jes√∫s sea tu mejor amigo? En este plan de tres d√≠as quiero invitarte a descubrirlo conmigo. Aprenderemos que la amistad con √âl empieza con conocerlo, abrirle la puerta y dejar que tambi√©n te conozca. Jes√∫s no solo quiere salvarte, quiere escucharte, caminar contigo y compartir tu vida como el mejor de tus amigos.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F63526%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/63526-conociendo-a-jesus-como-tu-mejor-amigo'
    },
    {
        id: 'd17',
        titulo: 'Todos los D√≠as',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '35 d√≠as',
        dias: 35,
        sinopsis: 'Un devocional de la escuela secundaria dise√±ado para ayudar a los estudiantes a desarrollar una fe cotidiana propia. En este devocional, encontrar√°s herramientas para ayudarte a desarrollar una fe que va contigo a todas partes en todo para cada d√≠a de tu vida.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F45520%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/45520-todos-los-dias'
    },
    {
        id: 'd18',
        titulo: '¬øC√≥mo Hacer La Voluntad De Dios?',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '12 d√≠as',
        dias: 12,
        sinopsis: 'Hemos escuchado muchas veces la frase: Hacer la voluntad de Dios. Sin duda, creemos que es algo importante, ya que la Biblia nos ense√±a que el que hace la voluntad de Dios permanece para siempre. Pero en realidad, ¬øsabemos lo que eso significa? No podemos conformarnos con tener una idea vaga y superficial acerca de cosas que son tan importantes, debemos conocerlas. Te invito a un maravilloso tiempo de reflexi√≥n y aprendizaje a trav√©s de este devocional para descubrir la voluntad de Dios para tu vida.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F51783%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/51783-como-hacer-la-voluntad-de-dios '
    },
    {
        id: 'd19',
        titulo: 'Nuevo en la Fe: Plan de Lectura de la Biblia',
        categoria: 'Introducci√≥n a la Fe',
        duracion: '16 d√≠as',
        dias: 16,
        sinopsis: '¬°Estamos muy emocionados de que hayas decidido seguir a Jes√∫s! Ten presente que no est√°s s√≥lo(a) en este trayecto y que hay muchos caminando junto contigo. Probablemente tengas varias preguntas acerca de c√≥mo seguir a Jes√∫s. Este plan de lectura te ayudar√° a descubrir qui√©n eres en Cristo. Te invitamos a que hagas en comunidad este nuevo caminar con Cristo.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F40626%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/40626-nuevo-en-la-fe-plan-de-lectura-de-la-biblia'
    },
    {
        id: 'd20',
        titulo: 'Investigando a Jes√∫s',
        categoria: 'Introducci√≥n a la Fe',
        duracion: '15 d√≠as',
        dias: 15,
        sinopsis: '¬øQui√©n es Jes√∫s? ¬øPor qu√© hoy seguimos hablando de alguien que naci√≥ y muri√≥ hace m√°s de dos mil a√±os? ¬øQu√© tuvo que haber ocurrido para que a√∫n hoy millones de personas lo sigan? Debemos hacernos las preguntas necesarias si queremos tener una fe con base s√≥lida. ¬øQu√© tal si investigamos un poco m√°s nuestra fe? ¬øQu√© tal si investigamos a Jes√∫s? Acomp√°√±anos en este recorrido a trav√©s del libro de Lucas.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F36113%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/36113-investigando-a-jesus'
    },
    {
        id: 'd21',
        titulo: 'Un Encuentro Con Dios, Transforma',
        categoria: 'Sanidad y Transformaci√≥n',
        duracion: '7 d√≠as',
        dias: 7,
        sinopsis: 'Te invitamos a explorar el plan ‚ÄúUn encuentro que transforma‚Äù, un recorrido devocional de 7 d√≠as que te llevar√° a profundizar en tu relaci√≥n con Dios. A trav√©s de la reflexi√≥n b√≠blica, la rendici√≥n y la obediencia, descubrir√°s c√≥mo Dios sale a tu encuentro, transforma tu coraz√≥n y te introduce en Su prop√≥sito. Cada d√≠a te ayudar√° a reconocer Su llamado, permanecer firme aun en la soledad y experimentar la revelaci√≥n de Dios en tu vida. Permite que un encuentro con Dios transforme tu historia.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67667%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67667-un-encuentro-con-dios-transforma'
    },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILIDADES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mezclar(arr) {
    const c=[...arr]; for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];} return c;
}

function obtenerCategorias() {
    return [...new Set(devocionalesData.map(d => d.categoria))].sort();
}

function obtenerDuraciones() {
    const duraciones = [...new Set(devocionalesData.map(d => d.duracion))];
    return duraciones.sort((a, b) => {
        const diasA = parseInt(a);
        const diasB = parseInt(b);
        return diasA - diasB;
    });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTADO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let categoriasSeleccionadas = [];
let duracionesSeleccionadas = [];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function crear(devocional) {
    const completado = (typeof progresoManager !== 'undefined') && progresoManager.estaCompletado(devocional.id);
    const stats = window._devotionalStatsCache[devocional.id] || { iniciados: 0, completados: 0 };

    return `
    <div class="devotional-card ${completado ? 'completed' : ''}" data-id="${devocional.id}">
        ${completado ? '<div class="completed-badge">‚úì</div>' : ''}
        
        <div class="devotional-image">
            <img src="${devocional.imagen}" alt="${devocional.titulo}" loading="lazy">
            
            <div class="devotional-duration">
                <i class="fa-solid fa-calendar-days"></i>
                <span>${devocional.duracion}</span>
            </div>
            
            
            <div class="devotional-stats">
                <i class="fa-solid fa-play-circle"></i>
                <span class="devotional-stat-number" id="iniciados-${devocional.id}">${stats.iniciados}</span>
                <i class="fa-solid fa-check-circle" style="margin-left: 4px; color: #4CAF50;"></i>
                <span class="devotional-stat-number" id="completados-${devocional.id}">${stats.completados}</span>
            </div>
        </div>
        
        <div class="devotional-info">
            <h3 class="devotional-title">${devocional.titulo}</h3>
            <p class="devotional-synopsis">${devocional.sinopsis}</p>
            
            <div class="devotional-actions">
                <a href="${devocional.link}" target="_blank" class="devotional-btn btn-go" data-id="${devocional.id}">
                    <i class="fa-solid fa-external-link-alt"></i> 
                </a>
                <button class="devotional-btn btn-info-dev" data-id="${devocional.id}">
                    <i class="fa-solid fa-info-circle"></i> 
                </button>
            </div>
            
            <div class="checkbox-wrapper-devotional">
                <input type="checkbox" id="${devocional.id}" ${completado ? 'checked' : ''}>
                <label for="${devocional.id}">
                    ${completado ? '‚úì Completado' : 'Completado'}
                </label>
            </div>
        </div>
    </div>`;
}

function render() {
    const g = document.getElementById('devocionales-grid');
    const r = document.getElementById('results-count');
    
    let f = devocionalesData.filter(dev => {
        const categoriasOk = categoriasSeleccionadas.length === 0 || categoriasSeleccionadas.includes(dev.categoria);
        const duracionesOk = duracionesSeleccionadas.length === 0 || duracionesSeleccionadas.includes(dev.duracion);
        return categoriasOk && duracionesOk;
    });
    
    const nc = f.filter(d => !(typeof progresoManager !== 'undefined' && progresoManager.estaCompletado(d.id)));
    const co = f.filter(d => typeof progresoManager !== 'undefined' && progresoManager.estaCompletado(d.id));
    
    const sortType = document.getElementById('sort-select')?.value || 'default';
    
    if (sortType === 'most-completed') {
        nc.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { completados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { completados: 0 };
            return statsB.completados - statsA.completados;
        });
        co.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { completados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { completados: 0 };
            return statsB.completados - statsA.completados;
        });
    } else if (sortType === 'most-started') {
        nc.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { iniciados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { iniciados: 0 };
            return statsB.iniciados - statsA.iniciados;
        });
        co.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { iniciados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { iniciados: 0 };
            return statsB.iniciados - statsA.iniciados;
        });
    } else {
        nc.splice(0, nc.length, ...mezclar(nc));
        co.splice(0, co.length, ...mezclar(co));
    }
    
    f = [...nc, ...co];
    
    if (!f.length) {
        g.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:3rem;">No se encontraron devocionales</p>';
        r.textContent = '';
    } else {
        g.innerHTML = f.map(crear).join('');
        r.textContent = `${f.length} devocional${f.length !== 1 ? 'es' : ''} disponible${f.length !== 1 ? 's' : ''}`;
        
        // Event listeners
        g.querySelectorAll('.checkbox-wrapper-devotional input').forEach(cb => {
    cb.addEventListener('change', async (e) => {
        const card = e.target.closest('.devotional-card');
        const devId = card.dataset.id;
        const dev = devocionalesData.find(d => d.id === devId);
        const label = e.target.nextElementSibling;
        
        if (e.target.checked) {
            if (progresoManager.marcarCompletado(devId, dev.titulo, 'devocionales')) {
                card.classList.add('completed');
                label.textContent = '‚úì Completado';
                if (!card.querySelector('.completed-badge')) {
                    card.insertAdjacentHTML('afterbegin', '<div class="completed-badge">‚úì</div>');
                }
                mostrarNotificacion('¬°Devocional completado! üéâ');
                if (typeof window.registrarCompletadoDevocional === 'function') {
                    await window.registrarCompletadoDevocional(devId);
                }
                setTimeout(() => render(), 100);
            }
        } else {
            if (progresoManager.desmarcarCompletado(devId)) {
                card.classList.remove('completed');
                label.textContent = 'Marcar como completado';
                const badge = card.querySelector('.completed-badge');
                if (badge) badge.remove();
                mostrarNotificacion('Devocional desmarcado');
                // ‚≠ê DECREMENTAR el contador
                if (typeof window.desregistrarCompletadoDevocional === 'function') {
                    await window.desregistrarCompletadoDevocional(devId);
                }
                setTimeout(() => render(), 100);
            }
        }
    });
});
        
        g.querySelectorAll('.btn-go').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                const devId = btn.dataset.id;
                if (typeof window.registrarInicioDevocional === 'function') {
                    await window.registrarInicioDevocional(devId);
                }
            });
        });
        
        g.querySelectorAll('.btn-info-dev').forEach(btn => {
            btn.addEventListener('click', () => {
                const devId = btn.dataset.id;
                const dev = devocionalesData.find(d => d.id === devId);
                if (dev) {
                    document.getElementById('modal-title').textContent = dev.titulo;
                    document.getElementById('modal-meta').innerHTML = `
                        <div class="modal-meta-item">
                            <i class="fa-solid fa-tag"></i>
                            <span>${dev.categoria}</span>
                        </div>
                        <div class="modal-meta-item">
                            <i class="fa-solid fa-calendar-days"></i>
                            <span>${dev.duracion}</span>
                        </div>
                        <div class="modal-meta-item">
                            <i class="fa-solid fa-hashtag"></i>
                            <span>${dev.dias} d√≠as</span>
                        </div>
                    `;
                    document.getElementById('modal-synopsis-text').textContent = dev.sinopsis;
                    document.getElementById('modal-synopsis').classList.add('show');
                }
            });
        });
    }
    
    actualizarChips();
    actualizarTextoBotones();
}

function cargarEstadisticas(devId) {
    if (typeof window.escucharCambiosDevocional === 'function') {
        window.escucharCambiosDevocional(devId, (stats) => {
            const iniciadosEl = document.getElementById(`iniciados-${devId}`);
            const completadosEl = document.getElementById(`completados-${devId}`);
            if (iniciadosEl) iniciadosEl.textContent = stats.iniciados;
            if (completadosEl) completadosEl.textContent = stats.completados;
        });
    }
}

function actualizarChips() {
    const c = document.getElementById('active-filters');
    c.innerHTML = '';
    
    categoriasSeleccionadas.forEach(cat => {
        const ch = document.createElement('div');
        ch.className = 'filter-chip';
        ch.innerHTML = `<span>Categor√≠a: ${cat}</span><span class="filter-chip-close" data-tipo="categoria" data-valor="${cat}">√ó</span>`;
        c.appendChild(ch);
    });
    
    duracionesSeleccionadas.forEach(dur => {
        const ch = document.createElement('div');
        ch.className = 'filter-chip';
        ch.innerHTML = `<span>Duraci√≥n: ${dur}</span><span class="filter-chip-close" data-tipo="duracion" data-valor="${dur}">√ó</span>`;
        c.appendChild(ch);
    });
    
    c.querySelectorAll('.filter-chip-close').forEach(btn => {
        btn.addEventListener('click', () => {
            const t = btn.dataset.tipo;
            const v = btn.dataset.valor;
            if (t === 'categoria') {
                categoriasSeleccionadas = categoriasSeleccionadas.filter(x => x !== v);
                renderCategorias();
            } else if (t === 'duracion') {
                duracionesSeleccionadas = duracionesSeleccionadas.filter(x => x !== v);
                renderDuraciones();
            }
            render();
        });
    });
}

function renderCategorias() {
    const menu = document.getElementById('categoria-menu');
    const categorias = obtenerCategorias();
    menu.innerHTML = categorias.map(c => `
        <div class="filter-option ${categoriasSeleccionadas.includes(c)?'selected':''}" data-valor="${c}">
            <input type="checkbox" id="cat-${c.replace(/\s+/g,'-')}" ${categoriasSeleccionadas.includes(c)?'checked':''}>
            <label for="cat-${c.replace(/\s+/g,'-')}">${c}</label>
        </div>
    `).join('');
    
    menu.querySelectorAll('.filter-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;
            const checkbox = opt.querySelector('input');
            checkbox.checked = !checkbox.checked;
            toggleCategoria(opt.dataset.valor);
        });
        opt.querySelector('input').addEventListener('change', (e) => {
            e.stopPropagation();
            toggleCategoria(opt.dataset.valor);
        });
    });
}

function renderDuraciones() {
    const menu = document.getElementById('duracion-menu');
    const duraciones = obtenerDuraciones();
    menu.innerHTML = duraciones.map(d => `
        <div class="filter-option ${duracionesSeleccionadas.includes(d)?'selected':''}" data-valor="${d}">
            <input type="checkbox" id="dur-${d.replace(/\s+/g,'-')}" ${duracionesSeleccionadas.includes(d)?'checked':''}>
            <label for="dur-${d.replace(/\s+/g,'-')}">${d}</label>
        </div>
    `).join('');
    
    menu.querySelectorAll('.filter-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;
            const checkbox = opt.querySelector('input');
            checkbox.checked = !checkbox.checked;
            toggleDuracion(opt.dataset.valor);
        });
        opt.querySelector('input').addEventListener('change', (e) => {
            e.stopPropagation();
            toggleDuracion(opt.dataset.valor);
        });
    });
}

function toggleCategoria(c) {
    if (categoriasSeleccionadas.includes(c)) {
        categoriasSeleccionadas = categoriasSeleccionadas.filter(x => x !== c);
    } else {
        categoriasSeleccionadas.push(c);
    }
    renderCategorias();
    render();
}

function toggleDuracion(d) {
    if (duracionesSeleccionadas.includes(d)) {
        duracionesSeleccionadas = duracionesSeleccionadas.filter(x => x !== d);
    } else {
        duracionesSeleccionadas.push(d);
    }
    renderDuraciones();
    render();
}

function actualizarTextoBotones() {
    const catBtn = document.getElementById('categoria-toggle');
    const durBtn = document.getElementById('duracion-toggle');
    
    if (categoriasSeleccionadas.length === 0) {
        catBtn.textContent = 'Categor√≠a (todas)';
    } else if (categoriasSeleccionadas.length === 1) {
        catBtn.textContent = `Categor√≠a: ${categoriasSeleccionadas[0]}`;
    } else {
        catBtn.textContent = `Categor√≠a (${categoriasSeleccionadas.length})`;
    }
    
    if (duracionesSeleccionadas.length === 0) {
        durBtn.textContent = 'Duraci√≥n (todas)';
    } else if (duracionesSeleccionadas.length === 1) {
        durBtn.textContent = `Duraci√≥n: ${duracionesSeleccionadas[0]}`;
    } else {
        durBtn.textContent = `Duraci√≥n (${duracionesSeleccionadas.length})`;
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
    if (typeof guardarConteoCategoria === 'function') {
        guardarConteoCategoria('devocionales', devocionalesData.length);
    }
    
    renderCategorias();
    renderDuraciones();
    render();
    
    devocionalesData.forEach(dev => cargarEstadisticas(dev.id));
    
    document.getElementById('categoria-toggle').addEventListener('click', () => {
        const menu = document.getElementById('categoria-menu');
        const btn = document.getElementById('categoria-toggle');
        menu.classList.toggle('show');
        btn.classList.toggle('active');
        document.getElementById('duracion-menu').classList.remove('show');
        document.getElementById('duracion-toggle').classList.remove('active');
    });
    
    document.getElementById('duracion-toggle').addEventListener('click', () => {
        const menu = document.getElementById('duracion-menu');
        const btn = document.getElementById('duracion-toggle');
        menu.classList.toggle('show');
        btn.classList.toggle('active');
        document.getElementById('categoria-menu').classList.remove('show');
        document.getElementById('categoria-toggle').classList.remove('active');
    });
    
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.filter-dropdown')) {
            document.querySelectorAll('.filter-menu').forEach(m => m.classList.remove('show'));
            document.querySelectorAll('.filter-btn-toggle').forEach(b => b.classList.remove('active'));
        }
    });
    
    document.getElementById('sort-select').addEventListener('change', () => {
        render();
    });
    
    document.getElementById('modal-close').addEventListener('click', () => {
        document.getElementById('modal-synopsis').classList.remove('show');
    });
    
    document.getElementById('modal-synopsis').addEventListener('click', (e) => {
        if (e.target.id === 'modal-synopsis') {
            document.getElementById('modal-synopsis').classList.remove('show');
        }
    });
    
    if (typeof iniciarScrollHeader === 'function') iniciarScrollHeader();
});
    </script>
    <script>
document.addEventListener("DOMContentLoaded", function () {

  /* ==============================
     SELECTORES (auto detecta libros o devocionales)
     ============================== */

  const filtersPanel =
    document.querySelector(".books-controls") ||
    document.querySelector(".devotional-controls");

  if (!filtersPanel) return;

  const grid =
    document.querySelector(".resource-grid");

  /* ==============================
     CREAR BOT√ìN TOGGLE FILTROS
     ============================== */

  const filtersToggle = document.createElement("button");
  filtersToggle.className = "filters-toggle";
  filtersToggle.innerHTML = 'üîçÔ∏é';
  document.body.appendChild(filtersToggle);

  /* ==============================
     CREAR BOT√ìN BACK TO TOP
     ============================== */

  const backToTop = document.createElement("button");
  backToTop.className = "back-to-top";
  backToTop.innerHTML = '‚¨Ü';
  document.body.appendChild(backToTop);

  /* ==============================
     ESTADO SCROLL
     ============================== */

  let lastScroll = window.scrollY;
  let manualOpen = false;

  window.addEventListener("scroll", function () {
    const currentScroll = window.scrollY;

    // Mostrar bot√≥n back-to-top
    if (currentScroll > 300) {
      backToTop.classList.add("visible");
    } else {
      backToTop.classList.remove("visible");
    }

    // Si fue abierto manualmente, no lo ocultes por scroll
    if (manualOpen) return;

    // Scroll hacia abajo ‚Üí ocultar
    if (currentScroll > lastScroll && currentScroll > 120) {
      filtersPanel.classList.add("hidden");
    }
    // Scroll hacia arriba ‚Üí mostrar
    else {
      filtersPanel.classList.remove("hidden");
    }

    lastScroll = currentScroll;
  });

  /* ==============================
     TOGGLE MANUAL FILTROS
     ============================== */

  filtersToggle.addEventListener("click", function () {
    manualOpen = !manualOpen;

    if (manualOpen) {
      filtersPanel.classList.remove("hidden");
      filtersPanel.classList.add("shown-manual");
    } else {
      filtersPanel.classList.remove("shown-manual");
    }
  });

  /* ==============================
     BACK TO TOP
     ============================== */

  backToTop.addEventListener("click", function () {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });

});
</script>
</body>
</html>