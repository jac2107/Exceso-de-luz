<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devocionales - Exceso de Luz</title>
    <link rel="stylesheet" href="exceso_de_luz.css">
    <style>
        .home-minimal {
            position: fixed;
            top: 18px; left: 18px;
            font-size: 0.85rem; font-weight: 500;
            color: rgba(0,0,0,0.85);
            text-decoration: none;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(6px);
            padding: 8px 14px;
            border-radius: 999px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            opacity: 0; pointer-events: none;
            transform: translateY(-6px);
            transition: opacity .25s ease, transform .25s ease, box-shadow .25s ease;
            z-index: 999;
        }
        .home-minimal.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .home-minimal:hover { background: rgba(255,248,235,0.95); box-shadow: 0 10px 24px rgba(0,0,0,0.18); }
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CONTROLES Y FILTROS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .devotional-controls {
            background: var(--bg-card);
            padding: clamp(1.5rem, 3vw, 2rem);
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .filter-dropdown {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .filter-btn-toggle {
            width: 100%;
            padding: 0.8rem 3rem 0.8rem 1rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .filter-btn-toggle:hover {
            border-color: var(--primary-color);
        }

        .filter-btn-toggle.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .filter-btn-toggle::after {
            content: 'â–¼';
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .filter-btn-toggle.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .filter-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 280px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .filter-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .filter-option {
            padding: 0.7rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: var(--color-beige);
        }

        .filter-option.selected {
            background: linear-gradient(135deg, 
                rgba(215, 204, 200, 0.3) 0%, 
                rgba(239, 235, 233, 0.2) 100%);
            font-weight: 600;
        }

        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            user-select: none;
        }

        .sort-select {
            padding: 0.7rem 2rem 0.7rem 0.8rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.6rem center;
            min-width: 180px;
            flex-shrink: 0;
        }

        .sort-select:hover {
            border-color: var(--primary-color);
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .active-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            min-height: 24px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary-color);
            color: var(--color-blanco);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: chipIn 0.3s ease;
        }

        @keyframes chipIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .filter-chip-close {
            cursor: pointer;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .filter-chip-close:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.8rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TARJETAS DE DEVOCIONAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .devotional-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s ease;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .devotional-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 35px rgba(93, 64, 55, 0.25);
        }

        /* Imagen del devocional */
        .devotional-image {
            position: relative;
            width: 100%;
            padding-top: 65%;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            overflow: hidden;
        }

        .devotional-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .devotional-card:hover .devotional-image img {
            transform: scale(1.05);
        }

        /* DuraciÃ³n del plan */
        .devotional-duration {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 0.5rem 0.9rem;
            background: rgba(0,0,0,0.85);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .devotional-duration i {
            font-size: 0.9rem;
        }

        /* CategorÃ­a */
        .devotional-category {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.95);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
        }

        /* Stats */
        .devotional-stats {
            position: absolute;
            bottom: 12px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.75);
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 11px;
            z-index: 10;
        }

        .devotional-stats i {
            font-size: 12px;
            color: #ffd700;
        }

        .devotional-stat-number {
            font-weight: 700;
            color: white;
        }

        /* InformaciÃ³n del devocional */
        .devotional-info {
            padding: 1.3rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .devotional-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 0.6rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .devotional-synopsis {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }

        /* Acciones */
        .devotional-actions {
            display: flex;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }

        .devotional-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-go {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .btn-go:hover {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn-info-dev {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(156, 39, 176, 0.3);
        }

        .btn-info-dev:hover {
            background: linear-gradient(135deg, #7B1FA2 0%, #6A1B9A 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.4);
        }

        /* Checkbox completado */
        .checkbox-wrapper-devotional {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .checkbox-wrapper-devotional input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success-color);
        }

        .checkbox-wrapper-devotional label {
            font-size: 0.88rem;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            font-weight: 500;
        }

        .checkbox-wrapper-devotional input:checked + label {
            color: var(--success-color);
            font-weight: 600;
        }

        /* Badge completado */
        .completed-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.4rem;
            z-index: 15;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            animation: badgePop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes badgePop {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.3) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* Tarjeta completada */
        .devotional-card.completed {
            opacity: 0.75;
            border-color: var(--success-color);
            
        }

        .devotional-card.completed::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, 
                rgba(76, 175, 80, 0.15) 0%, 
                rgba(56, 142, 60, 0.1) 100%);
            border-radius: 16px;
            pointer-events: none;
            z-index: 1;
        }

      

        /* Modal de sinopsis */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            max-width: 650px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: var(--bg-main);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--primary-color);
            color: white;
            transform: rotate(90deg);
        }

        .modal-devotional-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--text-primary);
        }

        .modal-devotional-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .modal-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.9rem;
            background: var(--bg-main);
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .modal-meta-item i {
            color: var(--primary-color);
        }

        .modal-devotional-synopsis {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .filter-section {
                flex-direction: column;
            }
            
            .filter-dropdown,
            .sort-select {
                min-width: 100%;
            }

            .devotional-title {
                font-size: 1.05rem;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }

            .devotional-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none;">
                    <h1>âœ¨ Exceso de Luz</h1>
                    <p class="tagline">Ilumina tu camino espiritual</p>
                </a>
            </div>
            <a href="index.html" class="btn-back">â† Volver</a>
        </div>
    </header>

    <main class="main-container">
        <div class="container">
            <div class="page-header">
                <div class="page-icon">ğŸ“–</div>
                <h2>Devocionales Diarios</h2>
                <p>Reflexiones y meditaciones para nutrir tu alma cada dÃ­a</p>
            </div>

            <div class="devotional-controls">
                <div class="filter-section">
                    <div class="filter-dropdown">
                        <button class="filter-btn-toggle" id="categoria-toggle">
                            CategorÃ­a (todas)
                        </button>
                        <div class="filter-menu" id="categoria-menu"></div>
                    </div>

                    <div class="filter-dropdown">
                        <button class="filter-btn-toggle" id="duracion-toggle">
                            DuraciÃ³n (todas)
                        </button>
                        <div class="filter-menu" id="duracion-menu"></div>
                    </div>

                    <select id="sort-select" class="sort-select">
                        <option value="default">Por defecto</option>
                        <option value="most-completed">âœ… MÃ¡s completados</option>
                        <option value="most-started">ğŸš€ MÃ¡s iniciados</option>
                    </select>
                </div>

                <div class="active-filters" id="active-filters"></div>
                <div class="results-count" id="results-count"></div>
            </div>

            <div class="resource-grid" id="devocionales-grid"></div>
        </div>
    </main>

    <!-- Modal de sinopsis -->
    <div class="modal-overlay" id="modal-synopsis">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">Ã—</button>
            <h3 class="modal-devotional-title" id="modal-title"></h3>
            <div class="modal-devotional-meta" id="modal-meta"></div>
            <p class="modal-devotional-synopsis" id="modal-synopsis-text"></p>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Exceso de Luz</p>
            <p class="verse">"LÃ¡mpara es a mis pies tu palabra" â€” Salmos 119:105</p>
        </div>
    </footer>
    <a href="index.html" class="home-minimal" aria-label="Volver al inicio">ğŸ¡° Volver</a>

    <script src="exceso_de_luz.js"></script>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyARYSgelNGVVpOryuq0Z3YCZxoqYA8TUns",
  authDomain: "exceso-de-luz.firebaseapp.com",
  projectId: "exceso-de-luz",
  storageBucket: "exceso-de-luz.firebasestorage.app",
  messagingSenderId: "442481525938",
  appId: "1:442481525938:web:e72a2672a589e594aeb5ab",
  measurementId: "G-GLTKTGY2GG"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window._devotionalStatsCache = window._devotionalStatsCache || {};

window.registrarInicioDevocional = async function(devocionalId) {
  try {
    const devRef = doc(db, 'devocionales', devocionalId);
    await setDoc(devRef, {
      iniciados: increment(1),
      ultimoInicio: new Date()
    }, { merge: true });
    console.log('âœ… Inicio registrado:', devocionalId);
  } catch(err) {
    console.error('âŒ Error registrarInicio', err);
  }
};

window.registrarCompletadoDevocional = async function(devocionalId) {
  try {
    const devRef = doc(db, 'devocionales', devocionalId);
    await setDoc(devRef, {
      completados: increment(1),
      ultimoCompletado: new Date()
    }, { merge: true });
    console.log('âœ… Completado registrado:', devocionalId);
  } catch(err) {
    console.error('âŒ Error registrarCompletado', err);
  }
};
window.desregistrarCompletadoDevocional = async function(devocionalId) {
  try {
    const devRef = doc(db, 'devocionales', devocionalId);
    await setDoc(devRef, {
      completados: increment(-1)
    }, { merge: true });
    console.log('âœ… Completado removido:', devocionalId);
  } catch(err) {
    console.error('âŒ Error desregistrarCompletado', err);
  }
};
window.escucharCambiosDevocional = function(devocionalId, callback) {
  const devRef = doc(db, 'devocionales', devocionalId);
  onSnapshot(devRef, snap => {
    const data = snap.exists() ? snap.data() : {};
    const stats = {
      iniciados: data.iniciados || 0,
      completados: data.completados || 0
    };
    window._devotionalStatsCache[devocionalId] = stats;
    callback(stats);
  }, err => console.error('âŒ snapshot error', err));
};

console.log('ğŸ”¥ Firebase devocionales stats ready');
</script>
    <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATOS DE DEVOCIONALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const devocionalesData = [
    {
        id: 'd1',
        titulo: 'La Nueva Era de la Esclavitud: Rompiendo Cadenas Invisibles',
        categoria: 'Sanidad y TransformaciÃ³n Personal',
        duracion: '5 dÃ­as',
        dias: 5,
        sinopsis: 'Ya no hay grilletes de hierro, pero seguimos siendo esclavos. Hoy, nuestras cadenas se llaman ansiedad, aprobaciÃ³n, deuda y distracciÃ³n. En este plan de 5 dÃ­as, basado en el libro "La Nueva Era de la Esclavitud", Roell Morales nos guÃ­a a travÃ©s de las Escrituras para identificar estos yugos modernos y redescubrir la libertad radical que Cristo comprÃ³ para nosotros.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67806%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67806-la-nueva-era-de-la-esclavitud-rompiendo-c'
    },
    {
        id: 'd2',
        titulo: 'Reescribe Tu Historia. 7 Pasos Para Dejar AtrÃ¡s Tu Vieja Vida',
        categoria: 'Sanidad y TransformaciÃ³n Personal',
        duracion: '7 dÃ­as',
        dias: 7,
        sinopsis: 'Este plan es una invitaciÃ³n a mirar tu pasado con esperanza, a confiar en el poder transformador de JesÃºs y a avanzar con una fe renovada. A lo largo de siete dÃ­as descubrirÃ¡s que tu historia no estÃ¡ determinada por tus errores, sino por la gracia de Dios, que sana, restaura y abre caminos nuevos. Cada dÃ­a te anima a soltar lo que te ata, abrazar la cruz y caminar hacia adelante con valentÃ­a y propÃ³sito.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67809%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67809-reescribe-tu-historia-7-pasos-para-dejar-atras-'
    },
    {
        id: 'd3',
        titulo: 'Caminar Como DiscÃ­pulos',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '3 dÃ­as',
        dias: 3,
        sinopsis: 'Caminar como discÃ­pulos es una serie devocional que nos llama a vivir el discipulado de manera prÃ¡ctica y personal. A travÃ©s de tres dÃ­as, aprendemos que seguir a JesÃºs implica amar a Dios y a las personas, comprometernos con una fe constante y compartir lo que Ã‰l hizo en nosotros. El discipulado comienza en el corazÃ³n, se vive en decisiones diarias y se multiplica cuando caminamos con otros. Es una invitaciÃ³n a pasar de solo creer a vivir como verdaderos discÃ­pulos de JesÃºs.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67144%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67144-caminar-como-discipulos'
    },
    {
        id: 'd4',
        titulo: 'Mujer Ideal Y Virtuosa.',
        categoria: 'Temas EspecÃ­ficos',
        duracion: '14 dÃ­as',
        dias: 14,
        sinopsis: 'En esta lectura estudiaremos, este versÃ­culo, ya que nos introduce y elogia a la "mujer virtuosa" o "ejemplar", declarando que su valor es extremadamente raro y precioso, superando con creces el de las joyas o piedras preciosas (como los rubÃ­es).',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F66917%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/66917-mujer-ideal-y-virtuosa'
    },
    {
        id: 'd5',
        titulo: 'El Dios No Conocido',
        categoria: 'Naturaleza y CarÃ¡cter de Dios',
        duracion: '7 dÃ­as',
        dias: 7,
        sinopsis: 'Este plan de lectura de 7 dÃ­as te guiarÃ¡ a conocer al Dios que muchos adoran sin conocer verdaderamente. A travÃ©s de la vida del profeta Samuel y pasajes clave de las Escrituras, descubrirÃ¡s cÃ³mo pasar de una fe heredada a una relaciÃ³n personal con Dios. AprenderÃ¡s a reconocer Su voz, rendir tu corazÃ³n, confrontar Ã­dolos y vivir como un instrumento de Su presencia. Al finalizar este plan, experimentarÃ¡s una fe mÃ¡s profunda, sensible y transformadora.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67193%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67193-el-dios-no-conocido'
    },
    {
        id: 'd6',
        titulo: 'Love Like Jesus',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '13 dÃ­as',
        dias: 13,
        sinopsis: 'Â¿CÃ³mo podemos aprender a vivir como JesÃºs si primero no amamos como Ã‰l?',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F2391%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/2391-love-like-jesus'
    },
    {
        id: 'd7',
        titulo: 'La Iglesia Amando, Sirviendo Y Transformando',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '14 dÃ­as',
        dias: 14,
        sinopsis: 'Este plan de lectura de 14 dÃ­as se centra en una serie de reflexiones de ministros, pastores y lÃ­deres, sobre el propÃ³sito esencial de la iglesia: Amar a Dios, Amar al prÃ³jimo y Transformar al mundo.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67996%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67996-la-iglesia-amando-sirviendo-y-transformando'
    },
    {
        id: 'd8',
        titulo: 'Â¡AmÃ©n! Â¡AmÃ©n! Â¡AmÃ©n!',
        categoria: 'Naturaleza y CarÃ¡cter de Dios',
        duracion: '5 dÃ­as',
        dias: 5,
        sinopsis: 'Este plan tiene como fin que, tomando las promesas que Dios nos da por medio de su Palabra, aprendamos a declarar las cosas que no son como si fueran.En cada reflexiÃ³n se utilizan anÃ©cdotas o situaciones que ocurren en el diario vivir.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F21852%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/21852-amen-amen-amen'
    },
    {
        id: 'd9',
        titulo: 'El Regalo Del PerdÃ³n',
        categoria: 'Sanidad y TransformaciÃ³n Personal',
        duracion: '7 dÃ­as',
        dias: 7,
        sinopsis: 'El perdÃ³n es un mandato del SeÃ±or donde su Palabra nos enseÃ±a que debemos poner sobre nuestra vida una base de misericordia, perdÃ³n y gracia. Esto no tiene nada que ver con los sentimientos en si â€œsentimosâ€ perdonar. La vida cristiana se vive en obediencia permanente a Dios y a su Palabra. Si te cuesta perdonar o no te han perdonado de la manera correcta, este devocional es para ti.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F46913%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/46913-el-regalo-del-perdon'
    },
    {
        id: 'd10',
        titulo: 'Afilando mi espada',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '365 dÃ­as',
        dias: 365,
        sinopsis: 'Este plan estÃ¡ diseÃ±ado para que internalices en las Escrituras, leyendo el Nuevo Testamento y algunos libros del Antiguo Testamento. A lo largo de esta travesÃ­a, descubrirÃ¡s cÃ³mo ambos testamentos se conectan a travÃ©s de profecÃ­as, promesas y revelaciones que apuntan hacia el cumplimiento en JesÃºs. Cada dÃ­a serÃ¡ una oportunidad para afilar tu espada espiritual, fortalecer tu fe y ganar una comprensiÃ³n mÃ¡s profunda de los principios y propÃ³sitos divinos. Â¡PrepÃ¡rate para un recorrido transformador que enriquecerÃ¡ tu vida y tu caminar con Dios!',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F53428%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/53428-afilando-mi-espada'
    },
    {
        id: 'd11',
        titulo: 'Nombres de Dios',
        categoria: 'Naturaleza y CarÃ¡cter de Dios',
        duracion: '14 dÃ­as',
        dias: 14,
        sinopsis: 'Este plan de lectura te guiarÃ¡ por algunos de los nombres de Dios revelados en la Biblia. Cada dÃ­a descubrirÃ¡s su significado original y el contexto en que fue revelado. ReflexionarÃ¡s sobre cÃ³mo cada nombre revela un aspecto Ãºnico de Su carÃ¡cter. AplicarÃ¡s estas verdades a tu vida diaria. Al final, conocerÃ¡s mÃ¡s profundamente quiÃ©n es Dios y cÃ³mo caminar con Ã‰l.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F62244%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/62244-nombres-de-dios'
    },
    {
        id: 'd12',
        titulo: 'CÃ³mo usar tu tiempo para Dios',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '4 dÃ­as',
        dias: 4,
        sinopsis: 'Devocional de 4 dÃ­as de R. C. Sproul sobre cÃ³mo usar tu tiempo para Dios. Cada devocional te llama a vivir en la presencia de Dios, bajo la autoridad de Dios y para la gloria de Dios.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F26738%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/26738-como-usar-tu-tiempo-para-dios'
    },
    {
        id: 'd13',
        titulo: 'SÃ­ Y AmÃ©n',
        categoria: 'Naturaleza y CarÃ¡cter de Dios',
        duracion: '5 dÃ­as',
        dias: 5,
        sinopsis: 'En estos cinco dÃ­as vamos a meditar las palabras SÃ­ y AmÃ©n. Vamos a descubrir cÃ³mo avanzar en las Ã¡reas donde estamos estancados.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F42587%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/42587-si-y-amen'
    },
    {
        id: 'd14',
        titulo: 'Primeros Pasos - Preguntas Y Respuestas',
        categoria: 'IntroducciÃ³n a la Fe',
        duracion: '10 dÃ­as',
        dias: 10,
        sinopsis: 'Alguna vez te has preguntado: Â¿QuÃ© sucediÃ³ cuando recibiste a Cristo? Â¿Puedo estar seguro de que soy salvo? Â¿QuÃ© sucede si un cristianos peca? Y muchas otras mÃ¡s. A lo largo de este devocional, podrÃ¡s encontrar respuestas a preguntas frecuentes en la vida del nuevo creyente, a la luz de la Palabra. Â¡Sigue adelante para entender mejor acerca de tu caminar con tu SeÃ±or!',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F43333%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/43333-primeros-pasos-preguntas-y-respuestas'
    },
    {
        id: 'd15',
        titulo: 'Tabla de contexto',
        categoria: 'IntroducciÃ³n a la Fe',
        duracion: '28 dÃ­as',
        dias: 28,
        sinopsis: 'Para muchos, la Biblia parece generar mÃ¡s confusiÃ³n que claridad. Como adolescente, te encuentras en una etapa de hacer preguntas, expresar dudas y debatir con la idea de la fe. Entonces, Â¿cÃ³mo puedes empezar a comprender la Biblia y su contexto? Este devocional de 4 semanas te ayudarÃ¡ a entender cÃ³mo las antiguas palabras de la Biblia se conectan con tu vida moderna y cotidiana.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F38954%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/38954-tabla-de-contexto'
    },
    {
        id: 'd16',
        titulo: 'Conociendo a JesÃºs Como Tu Mejor Amigo',
        categoria: 'IntroducciÃ³n a la Fe',
        duracion: '3 dÃ­as',
        dias: 3,
        sinopsis: 'Â¿QuÃ© significa que JesÃºs sea tu mejor amigo? En este plan de tres dÃ­as quiero invitarte a descubrirlo conmigo. Aprenderemos que la amistad con Ã‰l empieza con conocerlo, abrirle la puerta y dejar que tambiÃ©n te conozca. JesÃºs no solo quiere salvarte, quiere escucharte, caminar contigo y compartir tu vida como el mejor de tus amigos.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F63526%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/63526-conociendo-a-jesus-como-tu-mejor-amigo'
    },
    {
        id: 'd17',
        titulo: 'Todos los DÃ­as',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '35 dÃ­as',
        dias: 35,
        sinopsis: 'Un devocional de la escuela secundaria diseÃ±ado para ayudar a los estudiantes a desarrollar una fe cotidiana propia. En este devocional, encontrarÃ¡s herramientas para ayudarte a desarrollar una fe que va contigo a todas partes en todo para cada dÃ­a de tu vida.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F45520%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/45520-todos-los-dias'
    },
    {
        id: 'd18',
        titulo: 'Â¿CÃ³mo Hacer La Voluntad De Dios?',
        categoria: 'Vida Cristiana y Discipulado',
        duracion: '12 dÃ­as',
        dias: 12,
        sinopsis: 'Hemos escuchado muchas veces la frase: Hacer la voluntad de Dios. Sin duda, creemos que es algo importante, ya que la Biblia nos enseÃ±a que el que hace la voluntad de Dios permanece para siempre. Pero en realidad, Â¿sabemos lo que eso significa? No podemos conformarnos con tener una idea vaga y superficial acerca de cosas que son tan importantes, debemos conocerlas. Te invito a un maravilloso tiempo de reflexiÃ³n y aprendizaje a travÃ©s de este devocional para descubrir la voluntad de Dios para tu vida.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F51783%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/51783-como-hacer-la-voluntad-de-dios '
    },
    {
        id: 'd19',
        titulo: 'Nuevo en la Fe: Plan de Lectura de la Biblia',
        categoria: 'IntroducciÃ³n a la Fe',
        duracion: '16 dÃ­as',
        dias: 16,
        sinopsis: 'Â¡Estamos muy emocionados de que hayas decidido seguir a JesÃºs! Ten presente que no estÃ¡s sÃ³lo(a) en este trayecto y que hay muchos caminando junto contigo. Probablemente tengas varias preguntas acerca de cÃ³mo seguir a JesÃºs. Este plan de lectura te ayudarÃ¡ a descubrir quiÃ©n eres en Cristo. Te invitamos a que hagas en comunidad este nuevo caminar con Cristo.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F40626%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/40626-nuevo-en-la-fe-plan-de-lectura-de-la-biblia'
    },
    {
        id: 'd20',
        titulo: 'Investigando a JesÃºs',
        categoria: 'IntroducciÃ³n a la Fe',
        duracion: '15 dÃ­as',
        dias: 15,
        sinopsis: 'Â¿QuiÃ©n es JesÃºs? Â¿Por quÃ© hoy seguimos hablando de alguien que naciÃ³ y muriÃ³ hace mÃ¡s de dos mil aÃ±os? Â¿QuÃ© tuvo que haber ocurrido para que aÃºn hoy millones de personas lo sigan? Debemos hacernos las preguntas necesarias si queremos tener una fe con base sÃ³lida. Â¿QuÃ© tal si investigamos un poco mÃ¡s nuestra fe? Â¿QuÃ© tal si investigamos a JesÃºs? AcompÃ¡Ã±anos en este recorrido a travÃ©s del libro de Lucas.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F36113%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/36113-investigando-a-jesus'
    },
    {
        id: 'd21',
        titulo: 'Un Encuentro Con Dios, Transforma',
        categoria: 'Sanidad y TransformaciÃ³n Personal',
        duracion: '7 dÃ­as',
        dias: 7,
        sinopsis: 'Te invitamos a explorar el plan â€œUn encuentro que transformaâ€, un recorrido devocional de 7 dÃ­as que te llevarÃ¡ a profundizar en tu relaciÃ³n con Dios. A travÃ©s de la reflexiÃ³n bÃ­blica, la rendiciÃ³n y la obediencia, descubrirÃ¡s cÃ³mo Dios sale a tu encuentro, transforma tu corazÃ³n y te introduce en Su propÃ³sito. Cada dÃ­a te ayudarÃ¡ a reconocer Su llamado, permanecer firme aun en la soledad y experimentar la revelaciÃ³n de Dios en tu vida. Permite que un encuentro con Dios transforme tu historia.',
        imagen: 'https://www.bible.com/_next/image?url=https%3A%2F%2Fimageproxy.youversionapi.com%2Fhttps%3A%2F%2Fs3.amazonaws.com%2Fyvplans%2F67667%2F1280x720.jpg&w=1920&q=75',
        link: 'https://www.bible.com/reading-plans/67667-un-encuentro-con-dios-transforma'
    },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILIDADES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mezclar(arr) {
    const c=[...arr]; for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];} return c;
}

function obtenerCategorias() {
    return [...new Set(devocionalesData.map(d => d.categoria))].sort();
}

function obtenerDuraciones() {
    const duraciones = [...new Set(devocionalesData.map(d => d.duracion))];
    return duraciones.sort((a, b) => {
        const diasA = parseInt(a);
        const diasB = parseInt(b);
        return diasA - diasB;
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTADO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let categoriasSeleccionadas = [];
let duracionesSeleccionadas = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function crear(devocional) {
    const completado = (typeof progresoManager !== 'undefined') && progresoManager.estaCompletado(devocional.id);
    const stats = window._devotionalStatsCache[devocional.id] || { iniciados: 0, completados: 0 };

    return `
    <div class="devotional-card ${completado ? 'completed' : ''}" data-id="${devocional.id}">
        ${completado ? '<div class="completed-badge">âœ“</div>' : ''}
        
        <div class="devotional-image">
            <img src="${devocional.imagen}" alt="${devocional.titulo}" loading="lazy">
            
            <div class="devotional-duration">
                <i class="fa-solid fa-calendar-days"></i>
                <span>${devocional.duracion}</span>
            </div>
            
            <div class="devotional-category">${devocional.categoria}</div>
            
            <div class="devotional-stats">
                <i class="fa-solid fa-play-circle"></i>
                <span class="devotional-stat-number" id="iniciados-${devocional.id}">${stats.iniciados}</span>
                <i class="fa-solid fa-check-circle" style="margin-left: 4px; color: #4CAF50;"></i>
                <span class="devotional-stat-number" id="completados-${devocional.id}">${stats.completados}</span>
            </div>
        </div>
        
        <div class="devotional-info">
            <h3 class="devotional-title">${devocional.titulo}</h3>
            <p class="devotional-synopsis">${devocional.sinopsis}</p>
            
            <div class="devotional-actions">
                <a href="${devocional.link}" target="_blank" class="devotional-btn btn-go" data-id="${devocional.id}">
                    <i class="fa-solid fa-external-link-alt"></i> Ir al Plan
                </a>
                <button class="devotional-btn btn-info-dev" data-id="${devocional.id}">
                    <i class="fa-solid fa-info-circle"></i> Detalles
                </button>
            </div>
            
            <div class="checkbox-wrapper-devotional">
                <input type="checkbox" id="${devocional.id}" ${completado ? 'checked' : ''}>
                <label for="${devocional.id}">
                    ${completado ? 'âœ“ Completado' : 'Marcar como completado'}
                </label>
            </div>
        </div>
    </div>`;
}

function render() {
    const g = document.getElementById('devocionales-grid');
    const r = document.getElementById('results-count');
    
    let f = devocionalesData.filter(dev => {
        const categoriasOk = categoriasSeleccionadas.length === 0 || categoriasSeleccionadas.includes(dev.categoria);
        const duracionesOk = duracionesSeleccionadas.length === 0 || duracionesSeleccionadas.includes(dev.duracion);
        return categoriasOk && duracionesOk;
    });
    
    const nc = f.filter(d => !(typeof progresoManager !== 'undefined' && progresoManager.estaCompletado(d.id)));
    const co = f.filter(d => typeof progresoManager !== 'undefined' && progresoManager.estaCompletado(d.id));
    
    const sortType = document.getElementById('sort-select')?.value || 'default';
    
    if (sortType === 'most-completed') {
        nc.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { completados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { completados: 0 };
            return statsB.completados - statsA.completados;
        });
        co.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { completados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { completados: 0 };
            return statsB.completados - statsA.completados;
        });
    } else if (sortType === 'most-started') {
        nc.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { iniciados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { iniciados: 0 };
            return statsB.iniciados - statsA.iniciados;
        });
        co.sort((a, b) => {
            const statsA = window._devotionalStatsCache[a.id] || { iniciados: 0 };
            const statsB = window._devotionalStatsCache[b.id] || { iniciados: 0 };
            return statsB.iniciados - statsA.iniciados;
        });
    } else {
        nc.splice(0, nc.length, ...mezclar(nc));
        co.splice(0, co.length, ...mezclar(co));
    }
    
    f = [...nc, ...co];
    
    if (!f.length) {
        g.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:3rem;">No se encontraron devocionales</p>';
        r.textContent = '';
    } else {
        g.innerHTML = f.map(crear).join('');
        r.textContent = `${f.length} devocional${f.length !== 1 ? 'es' : ''} disponible${f.length !== 1 ? 's' : ''}`;
        
        // Event listeners
        g.querySelectorAll('.checkbox-wrapper-devotional input').forEach(cb => {
    cb.addEventListener('change', async (e) => {
        const card = e.target.closest('.devotional-card');
        const devId = card.dataset.id;
        const dev = devocionalesData.find(d => d.id === devId);
        const label = e.target.nextElementSibling;
        
        if (e.target.checked) {
            if (progresoManager.marcarCompletado(devId, dev.titulo, 'devocionales')) {
                card.classList.add('completed');
                label.textContent = 'âœ“ Completado';
                if (!card.querySelector('.completed-badge')) {
                    card.insertAdjacentHTML('afterbegin', '<div class="completed-badge">âœ“</div>');
                }
                mostrarNotificacion('Â¡Devocional completado! ğŸ‰');
                if (typeof window.registrarCompletadoDevocional === 'function') {
                    await window.registrarCompletadoDevocional(devId);
                }
                setTimeout(() => render(), 100);
            }
        } else {
            if (progresoManager.desmarcarCompletado(devId)) {
                card.classList.remove('completed');
                label.textContent = 'Marcar como completado';
                const badge = card.querySelector('.completed-badge');
                if (badge) badge.remove();
                mostrarNotificacion('Devocional desmarcado');
                // â­ DECREMENTAR el contador
                if (typeof window.desregistrarCompletadoDevocional === 'function') {
                    await window.desregistrarCompletadoDevocional(devId);
                }
                setTimeout(() => render(), 100);
            }
        }
    });
});
        
        g.querySelectorAll('.btn-go').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                const devId = btn.dataset.id;
                if (typeof window.registrarInicioDevocional === 'function') {
                    await window.registrarInicioDevocional(devId);
                }
            });
        });
        
        g.querySelectorAll('.btn-info-dev').forEach(btn => {
            btn.addEventListener('click', () => {
                const devId = btn.dataset.id;
                const dev = devocionalesData.find(d => d.id === devId);
                if (dev) {
                    document.getElementById('modal-title').textContent = dev.titulo;
                    document.getElementById('modal-meta').innerHTML = `
                        <div class="modal-meta-item">
                            <i class="fa-solid fa-tag"></i>
                            <span>${dev.categoria}</span>
                        </div>
                        <div class="modal-meta-item">
                            <i class="fa-solid fa-calendar-days"></i>
                            <span>${dev.duracion}</span>
                        </div>
                        <div class="modal-meta-item">
                            <i class="fa-solid fa-hashtag"></i>
                            <span>${dev.dias} dÃ­as</span>
                        </div>
                    `;
                    document.getElementById('modal-synopsis-text').textContent = dev.sinopsis;
                    document.getElementById('modal-synopsis').classList.add('show');
                }
            });
        });
    }
    
    actualizarChips();
    actualizarTextoBotones();
}

function cargarEstadisticas(devId) {
    if (typeof window.escucharCambiosDevocional === 'function') {
        window.escucharCambiosDevocional(devId, (stats) => {
            const iniciadosEl = document.getElementById(`iniciados-${devId}`);
            const completadosEl = document.getElementById(`completados-${devId}`);
            if (iniciadosEl) iniciadosEl.textContent = stats.iniciados;
            if (completadosEl) completadosEl.textContent = stats.completados;
        });
    }
}

function actualizarChips() {
    const c = document.getElementById('active-filters');
    c.innerHTML = '';
    
    categoriasSeleccionadas.forEach(cat => {
        const ch = document.createElement('div');
        ch.className = 'filter-chip';
        ch.innerHTML = `<span>CategorÃ­a: ${cat}</span><span class="filter-chip-close" data-tipo="categoria" data-valor="${cat}">Ã—</span>`;
        c.appendChild(ch);
    });
    
    duracionesSeleccionadas.forEach(dur => {
        const ch = document.createElement('div');
        ch.className = 'filter-chip';
        ch.innerHTML = `<span>DuraciÃ³n: ${dur}</span><span class="filter-chip-close" data-tipo="duracion" data-valor="${dur}">Ã—</span>`;
        c.appendChild(ch);
    });
    
    c.querySelectorAll('.filter-chip-close').forEach(btn => {
        btn.addEventListener('click', () => {
            const t = btn.dataset.tipo;
            const v = btn.dataset.valor;
            if (t === 'categoria') {
                categoriasSeleccionadas = categoriasSeleccionadas.filter(x => x !== v);
                renderCategorias();
            } else if (t === 'duracion') {
                duracionesSeleccionadas = duracionesSeleccionadas.filter(x => x !== v);
                renderDuraciones();
            }
            render();
        });
    });
}

function renderCategorias() {
    const menu = document.getElementById('categoria-menu');
    const categorias = obtenerCategorias();
    menu.innerHTML = categorias.map(c => `
        <div class="filter-option ${categoriasSeleccionadas.includes(c)?'selected':''}" data-valor="${c}">
            <input type="checkbox" id="cat-${c.replace(/\s+/g,'-')}" ${categoriasSeleccionadas.includes(c)?'checked':''}>
            <label for="cat-${c.replace(/\s+/g,'-')}">${c}</label>
        </div>
    `).join('');
    
    menu.querySelectorAll('.filter-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;
            const checkbox = opt.querySelector('input');
            checkbox.checked = !checkbox.checked;
            toggleCategoria(opt.dataset.valor);
        });
        opt.querySelector('input').addEventListener('change', (e) => {
            e.stopPropagation();
            toggleCategoria(opt.dataset.valor);
        });
    });
}

function renderDuraciones() {
    const menu = document.getElementById('duracion-menu');
    const duraciones = obtenerDuraciones();
    menu.innerHTML = duraciones.map(d => `
        <div class="filter-option ${duracionesSeleccionadas.includes(d)?'selected':''}" data-valor="${d}">
            <input type="checkbox" id="dur-${d.replace(/\s+/g,'-')}" ${duracionesSeleccionadas.includes(d)?'checked':''}>
            <label for="dur-${d.replace(/\s+/g,'-')}">${d}</label>
        </div>
    `).join('');
    
    menu.querySelectorAll('.filter-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;
            const checkbox = opt.querySelector('input');
            checkbox.checked = !checkbox.checked;
            toggleDuracion(opt.dataset.valor);
        });
        opt.querySelector('input').addEventListener('change', (e) => {
            e.stopPropagation();
            toggleDuracion(opt.dataset.valor);
        });
    });
}

function toggleCategoria(c) {
    if (categoriasSeleccionadas.includes(c)) {
        categoriasSeleccionadas = categoriasSeleccionadas.filter(x => x !== c);
    } else {
        categoriasSeleccionadas.push(c);
    }
    renderCategorias();
    render();
}

function toggleDuracion(d) {
    if (duracionesSeleccionadas.includes(d)) {
        duracionesSeleccionadas = duracionesSeleccionadas.filter(x => x !== d);
    } else {
        duracionesSeleccionadas.push(d);
    }
    renderDuraciones();
    render();
}

function actualizarTextoBotones() {
    const catBtn = document.getElementById('categoria-toggle');
    const durBtn = document.getElementById('duracion-toggle');
    
    if (categoriasSeleccionadas.length === 0) {
        catBtn.textContent = 'CategorÃ­a (todas)';
    } else if (categoriasSeleccionadas.length === 1) {
        catBtn.textContent = `CategorÃ­a: ${categoriasSeleccionadas[0]}`;
    } else {
        catBtn.textContent = `CategorÃ­a (${categoriasSeleccionadas.length})`;
    }
    
    if (duracionesSeleccionadas.length === 0) {
        durBtn.textContent = 'DuraciÃ³n (todas)';
    } else if (duracionesSeleccionadas.length === 1) {
        durBtn.textContent = `DuraciÃ³n: ${duracionesSeleccionadas[0]}`;
    } else {
        durBtn.textContent = `DuraciÃ³n (${duracionesSeleccionadas.length})`;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
    if (typeof guardarConteoCategoria === 'function') {
        guardarConteoCategoria('devocionales', devocionalesData.length);
    }
    
    renderCategorias();
    renderDuraciones();
    render();
    
    devocionalesData.forEach(dev => cargarEstadisticas(dev.id));
    
    document.getElementById('categoria-toggle').addEventListener('click', () => {
        const menu = document.getElementById('categoria-menu');
        const btn = document.getElementById('categoria-toggle');
        menu.classList.toggle('show');
        btn.classList.toggle('active');
        document.getElementById('duracion-menu').classList.remove('show');
        document.getElementById('duracion-toggle').classList.remove('active');
    });
    
    document.getElementById('duracion-toggle').addEventListener('click', () => {
        const menu = document.getElementById('duracion-menu');
        const btn = document.getElementById('duracion-toggle');
        menu.classList.toggle('show');
        btn.classList.toggle('active');
        document.getElementById('categoria-menu').classList.remove('show');
        document.getElementById('categoria-toggle').classList.remove('active');
    });
    
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.filter-dropdown')) {
            document.querySelectorAll('.filter-menu').forEach(m => m.classList.remove('show'));
            document.querySelectorAll('.filter-btn-toggle').forEach(b => b.classList.remove('active'));
        }
    });
    
    document.getElementById('sort-select').addEventListener('change', () => {
        render();
    });
    
    document.getElementById('modal-close').addEventListener('click', () => {
        document.getElementById('modal-synopsis').classList.remove('show');
    });
    
    document.getElementById('modal-synopsis').addEventListener('click', (e) => {
        if (e.target.id === 'modal-synopsis') {
            document.getElementById('modal-synopsis').classList.remove('show');
        }
    });
    
    if (typeof iniciarScrollHeader === 'function') iniciarScrollHeader();
});
    </script>
</body>
</html>