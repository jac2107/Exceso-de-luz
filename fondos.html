<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fondos de Pantalla - Exceso de Luz</title>
    <link rel="stylesheet" href="exceso_de_luz.css">
    <style>
      .wallpaper-image-wrapper {
    position: relative;
}
/* cajita blanca peque√±a, fija arriba-derecha */
.stats {
  position: absolute;
  top: 12px;
  right: 20px;

  display: flex;
  align-items: center;
  gap: 10px;

  background: #d7ccc8;
  padding: 4px 8px;
  border-radius: 15px;

  font-size: 17px;
  z-index: 30;
}

/* centrado y control del icono y n√∫mero */

.stat-item {
  background: transparent !important;
  padding: 0 !important;
  border-radius: transparent !important;
}

/* icono peque√±o */
.stat-item i {
  font-size: 17px;   /* tama√±o del icono */
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.stat-item i {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  background: transparent !important;
}


        /* ‚îÄ‚îÄ Bot√≥n flotante "Volver" ‚îÄ‚îÄ */
        .home-minimal {
            position: fixed;
            top: 18px; left: 18px;
            font-size: 0.85rem; font-weight: 500;
            color: rgba(0,0,0,0.85);
            text-decoration: none;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(6px);
            padding: 8px 14px;
            border-radius: 999px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            opacity: 0; pointer-events: none;
            transform: translateY(-6px);
            transition: opacity .25s ease, transform .25s ease, box-shadow .25s ease;
            z-index: 999;
        }
        .home-minimal.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .home-minimal:hover { background: rgba(255,248,235,0.95); box-shadow: 0 10px 24px rgba(0,0,0,0.18); }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FILTROS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .wallpaper-controls {
            background: var(--bg-card); padding: clamp(1.5rem, 3vw, 2rem);
            border-radius: 12px; margin-bottom: 2rem; box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

       .filter-section {
    position: sticky;
    top: 0;
    z-index: 1500;
    background: var(--bg-main);
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
}


        .filter-dropdown {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .filter-btn-toggle {
            width: 100%;
            padding: 0.8rem 3rem 0.8rem 1rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .filter-btn-toggle:hover {
            border-color: var(--primary-color);
        }

        .filter-btn-toggle.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .filter-btn-toggle::after {
            content: '‚ñº';
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .filter-btn-toggle.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .filter-menu {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    right: 0;
    background: var(--bg-card);
    border: 1.5px solid var(--border-color);
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);

    max-height: 400px;          /* m√°s alto */
    overflow-y: auto;
    padding: 0.5rem;

    z-index: 1000;

    display: none;
}


        .filter-menu.show {
    display: grid;
    grid-template-columns: repeat(2, 1fr);  /* üëà DOS COLUMNAS */
    gap: 6px;
    animation: slideDown 0.3s ease;
}


        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .filter-option {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0.6rem 0.8rem;
    background: var(--bg-main);
    transition: all 0.2s ease;
}

.filter-option:hover {
    background: var(--color-beige);
    transform: scale(1.02);
}

@media (max-width: 600px) {
    .filter-menu.show {
        grid-template-columns: 1fr;
    }
}

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: var(--color-beige);
        }

        .filter-option.selected {
            background: linear-gradient(135deg, 
                rgba(215, 204, 200, 0.3) 0%, 
                rgba(239, 235, 233, 0.2) 100%);
            font-weight: 600;
        }

        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            user-select: none;
        }

        .active-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            min-height: 24px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary-color);
            color: var(--color-blanco);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: chipIn 0.3s ease;
        }

        @keyframes chipIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .filter-chip-close {
            cursor: pointer;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .filter-chip-close:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TARJETAS DE FONDOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .wallpaper-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .wallpaper-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .wallpaper-image-wrapper {
            position: relative;
            width: 100%;
            padding-top: 177.78%; /* 9:16 aspect ratio */
            overflow: hidden;
            background: var(--bg-main);
            cursor: pointer;
        }

        .wallpaper-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .wallpaper-card:hover .wallpaper-image {
            transform: scale(1.05);
        }

        .wallpaper-category {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 0.4rem 0.8rem;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            z-index: 2;
        }

        .checkbox-wrapper-wallpaper {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }

        .checkbox-wrapper-wallpaper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success-color);
        }

        .checkbox-wrapper-wallpaper label {
            font-size: 0.88rem;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            font-weight: 500;
        }

        .checkbox-wrapper-wallpaper input:checked + label {
            color: var(--success-color);
            font-weight: 600;
        }

        .wallpaper-card.completed {
            opacity: 0.6;
            border-color: var(--success-color);
        }

        .wallpaper-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: var(--success-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 900;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL EXPANDIDO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .modal-image-container {
            position: relative;
            overflow: hidden;
            touch-action: pinch-zoom;
            cursor: grab;
        }

        .modal-image-container:active {
            cursor: grabbing;
        }

        .modal-image {
            max-width: 90vw;
            max-height: 80vh;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .modal-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 0.5rem;
            z-index: 10000;
        }

        .modal-btn {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .modal-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .modal-download {
            background: var(--primary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-download:hover {
            background: var(--color-marron);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .filter-section { flex-direction: column; }
            .filter-dropdown { min-width: 100%; }
        }
        /* ===== Correciones dropdown categorias - pegar al final ===== */
.filter-section, .filter-dropdown { overflow: visible !important; }

/* Asegurar que el bot√≥n est√© posicionado para su ::after */
.filter-btn-toggle { position: relative; z-index: 2100; }

/* Men√∫ */
.filter-menu {
  position: absolute;
  top: calc(100% + 0.5rem);
  left: 0;
  /* no usar right:0 para evitar estirado que cause clipping en contenedores extra */
  width: auto;
  min-width: 220px;           /* m√≠nimo √∫til */
  max-width: 420px;           /* evita que ocupe toda la pantalla */
  background: var(--bg-card);
  border: 1.5px solid var(--border-color);
  border-radius: 12px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  max-height: 420px;
  overflow-y: auto;
  padding: 0.45rem;
  z-index: 2200;              /* por encima del resto */
  display: none;
  box-sizing: border-box;
}

/* Mostrar en grid de 2 columnas */
.filter-menu.show {
  display: grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 8px;
  animation: slideDown 0.22s ease;
}

/* En m√≥viles 1 columna */
@media (max-width: 600px) {
  .filter-menu.show {
    grid-template-columns: 1fr;
    min-width: 160px;
    max-width: calc(100vw - 32px);
  }
}

/* Opciones dentro del grid */
.filter-option {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.5rem;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.04);
  background: var(--bg-main);
  cursor: pointer;
}

/* Garantizar que el menu no quede recortado por padres con overflow:hidden */
.container, .wallpaper-controls, .filter-section {
  overflow: visible !important;
}

/* Mejor lectura: checkbox a la izquierda, label al lado */
.filter-option input[type="checkbox"] { margin: 0 0.25rem 0 0; flex: 0 0 auto; }
.filter-option label { flex: 1 1 auto; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Arreglar ids/labels (estilos cuando selected) */
.filter-option.selected { outline: 2px solid rgba(93,64,55,0.08); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SELECTOR DE ORDENAMIENTO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.sort-select {
    padding: 0.7rem 2rem 0.7rem 0.8rem;
    background: var(--bg-main);
    border: 1.5px solid var(--border-color);
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.6rem center;
    min-width: 140px;
    flex-shrink: 0;
}

.sort-select:hover {
    border-color: var(--primary-color);
}

.sort-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOTONES DE GRID ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.grid-btn {
    width: 42px;
    height: 42px;
    padding: 0;
    background: #1a1a1a;
    border: 2px solid #333;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin: 0;
}

.grid-btn i {
    font-size: 16px;
}

.grid-btn:hover {
    background: #2a2a2a;
    border-color: #555;
}

.grid-btn.active {
    background: var(--primary-color);
    border-color: var(--primary-color);
    box-shadow: 0 0 10px rgba(93, 64, 55, 0.4);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GRID AUTOM√ÅTICO RESPONSIVE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

#fondos-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
}

#fondos-grid[data-user-choice] {
    grid-template-columns: var(--user-grid-columns);
}

@media (max-width: 1400px) {
    #fondos-grid:not([data-user-choice]) {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
}

@media (max-width: 1200px) {
    #fondos-grid:not([data-user-choice]) {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }
}

@media (max-width: 768px) {
    #fondos-grid:not([data-user-choice]) {
        grid-template-columns: repeat(2, 1fr);
    }
    
    /* Respetar elecci√≥n del usuario en tablet */
    #fondos-grid[data-user-choice="3"] {
        grid-template-columns: repeat(3, 1fr) !important;
    }
    
    #fondos-grid[data-user-choice="4"] {
        grid-template-columns: repeat(3, 1fr) !important;
    }
    
    #fondos-grid[data-user-choice="5"] {
        grid-template-columns: repeat(4, 1fr) !important;
    }
}

/* M√ìVIL PEQUE√ëO - aqu√≠ S√ç limitamos m√°s */
@media (max-width: 480px) {
    #fondos-grid:not([data-user-choice]) {
        grid-template-columns: repeat(1, 1fr);
    }
    
    /* En m√≥vil peque√±o respetamos pero con l√≠mite */
    #fondos-grid[data-user-choice="3"] {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    
    #fondos-grid[data-user-choice="4"],
    #fondos-grid[data-user-choice="5"] {
        grid-template-columns: repeat(3, 1fr) !important;
    }
}
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESPONSIVE PARA FILTROS Y CONTROLES
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Desktop: todo en una fila */
.filter-section {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: flex-start;
}

/* Tablet y m√≥vil */
@media (max-width: 768px) {
    .filter-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.8rem;
    }
    
    .filter-dropdown {
        width: 100%;
        min-width: 100%;
    }
    
    /* Botones de grid + selector en la misma fila */
    .filter-section > div[style] {
        display: flex !important;
        gap: 0.5rem !important;
        width: 100%;
    }
    
    .filter-section .sort-select {
        flex: 1;
        min-width: 0;
    }
    
    /* Botones de grid m√°s grandes en m√≥vil */
    .grid-btn {
        width: 48px;
        height: 48px;
    }
    
    .grid-btn i {
        font-size: 18px;
    }
}

/* M√≥vil peque√±o: botones + select en 2 filas */
@media (max-width: 460px) {
    .filter-section {
        gap: 0.6rem;
    }
    
    .filter-section > div[style] {
        flex-wrap: wrap !important;
        justify-content: center !important;
    }
    
    /* Botones juntos */
    .grid-btn {
        flex: 0 0 auto;
    }
    
    /* Selector ocupa toda la fila */
    .filter-section .sort-select {
        flex: 1 1 100%;
        width: 100%;
    }
}
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none;">
                    <h1>‚ú® Exceso de Luz</h1>
                    <p class="tagline">Ilumina tu camino espiritual</p>
                </a>
            </div>
            <a href="index.html" class="btn-back">‚Üê Volver al Inicio</a>
        </div>
    </header>

    <main class="main-container">
        <div class="container">
            <div class="page-header">
                <div class="page-icon">üñºÔ∏è</div>
                <h2>Fondos de Pantalla</h2>
                <p>Cambiemos a un fondo lleno de LUZ</p>
            </div>

            <div class="wallpaper-controls">
                <div class="filter-section">
    <div class="filter-dropdown">
        <button class="filter-btn-toggle" id="categoria-toggle">
            Categor√≠a (todas)
        </button>
        <div class="filter-menu" id="categoria-menu"></div>
    </div>

    <!-- Botones de grid agrupados -->
    <div style="display: flex; gap: 0.5rem; align-items: center; flex-shrink: 0;">
        <button class="grid-btn" data-cols="3" title="3 columnas">
            <i class="fa-solid fa-grip-lines"></i>
        </button>
        <button class="grid-btn active" data-cols="4" title="4 columnas">
            <i class="fa-solid fa-grip"></i>
        </button>
        <button class="grid-btn" data-cols="5" title="5 columnas">
            <i class="fa-solid fa-table-cells"></i>
        </button>
    </div>

    <!-- Selector de ordenamiento -->
    <select id="sort-select" class="sort-select">
        <option value="default">Por defecto</option>
        <option value="most-viewed">üëÅÔ∏è M√°s vistos</option>
        <option value="most-downloaded">üì• M√°s descargados</option>
    </select>
</div>
                <div class="active-filters" id="active-filters"></div>
                <div class="results-count" id="results-count"></div>
            </div>

            <div class="resource-grid" id="fondos-grid"></div>
        </div>
    </main>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-controls">
            <button class="modal-btn" id="btn-close-modal">√ó</button>
        </div>
        <div class="modal-content">
            <div class="modal-image-container" id="modal-image-container">
                <img class="modal-image" id="modal-image" src="" alt="Fondo expandido">
            </div>
            <button class="modal-download" id="modal-download">
                üì• Descargar Fondo
            </button>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Exceso de Luz</p>
            <p class="verse">"Ustedes son la luz del mundo" - Mateo 5:14 NVI</p>
        </div>
    </footer>
    <a href="index.html" class="home-minimal" aria-label="Volver al inicio">ü°∞ Volver</a>

    <script src="exceso_de_luz.js"></script>
    <script>
const fondosData = [
    {id:'f1', url:'Fondos/1d5abd777fa6cb9dddbea1434bd7bfcb.jpg', categorias:['Mar','Jes√∫s']},
    {id:'f2', url:'Fondos/53cce2204f15ccb78c65f538338d79b5.jpg', categorias:['Mar','Peces']},
    {id:'f3', url:'Fondos/05532cef8de5c1ea60c37e4785f591c4.jpg', categorias:['Cruz']},
    {id:'f4', url:'Fondos/7863b5fdafc2008f17df5c2e72ba7b23.jpg', categorias:['Letras','Colores']},
    {id:'f5', url:'Fondos/8844be6fb0ddcb45941934a5d12a7c0f.jpg', categorias:['Ovejas','Letras']},
    {id:'f6', url:'Fondos/11492f1bc627d0de2139bcd474dff291.jpg', categorias:['Cruz']},
    {id:'f7', url:'Fondos/800419f31a0fa2a4dab5a67972ea8c35.jpg', categorias:['Flores','Letras']},
    {id:'f8', url:'Fondos/1512054-wallpapers-cristianos-1080x1920-pictures.jpg', categorias:['Paisaje']},
    {id:'f9', url:'Fondos/490251422208fffcc069007a39a53819.jpg', categorias:['Letras','Evangelio']},
    {id:'f10', url:'Fondos/dff6fed88ada4b36ffd40798f80baccb.jpg', categorias:['Game']},
    {id:'f11', url:'Fondos/image (2).png', categorias:['Paisaje','Letras']},
    {id:'f12', url:'Fondos/image (1).png', categorias:['Jes√∫s','Paisaje']},
    {id:'f13', url:'Fondos/image (3).png', categorias:['Paisaje','Letras']},
    {id:'f14', url:'Fondos/image.png', categorias:['Paisaje','Jes√∫s']},
    {id:'f15', url:'Fondos/pngtree-god-is-good-picture-image_15392512.jpg', categorias:['Letras']},
    {id:'f16', url:'Fondos/Jes√∫s.jpeg', categorias:['Jes√∫s','Letras']},
    {id:'f17', url:'Fondos/JESUS.jpeg', categorias:['Letras','Ingles']},
    {id:'f18', url:'Fondos/ea9d198b05f33ba95588fc4190591b59.jpg', categorias:['Letras']},
    {id:'f19', url:'Fondos/88fb86a847d96dd5f6ccdb367e7f7527.jpg', categorias:['Jes√∫s','Oscuro']},
    {id:'f20', url:'Fondos/532b64a02407ef02e3034bca389eb6ed.jpg', categorias:['Flores','Oscuro']},
    {id:'f21', url:'Fondos/57179cb3af3120051c4b7a5716b88471.jpg', categorias:['Oscuro','Letras']},
    {id:'f22', url:'Fondos/871998e422561d96f650f122b524042a.jpg', categorias:['Oscuro','Letras']},
    {id:'f23', url:'Fondos/514ade76d47ced994761fc7811c23fe6.jpg', categorias:['Oscuro','Cruz']},
    {id:'f24', url:'Fondos/86b03961fde84c25beee5d198d08bd0a.jpg', categorias:['Evangelio','Oscuro']},
    {id:'f25', url:'Fondos/9ef5921a0c20aa3e721b91307ee202fe.jpg', categorias:['Jes√∫s','Paisaje']},
    {id:'f26', url:'Fondos/e0755b27403594ae8d7ddabb563d8d16.jpg', categorias:['Armadura','Snoopy']},
    {id:'f27', url:'Fondos/d411631cf7251a50040d898cfaee7243.jpg', categorias:['Oscuro','Snoopy']},
    {id:'f28', url:'Fondos/24b0ec5621e5115a8f3693857e717cb2.jpg', categorias:['Jes√∫s','Letras']},
    {id:'f29', url:'Fondos/950c7d468f4351101cf8c9307c0df78d.jpg', categorias:['Oscuro','Game']},
    {id:'f30', url:'Fondos/41ee94da850ebe0934a4b0b3b8f3bd9b.jpg', categorias:['Letras','Materia']},
    {id:'f31', url:'Fondos/doc1.png', categorias:['Jes√∫s','Futbol']},
    {id:'f32', url:'Fondos/doc1 (2).png', categorias:['Jes√∫s','Futbol']},
    {id:'f33', url:'Fondos/image (4).png', categorias:['Jes√∫s','Oscuro']},
    {id:'f34', url:'Fondos/7173a6bd55469098ffb4b24bb118fa63.jpg', categorias:['Letras','Oscuro']},
    {id:'f35', url:'Fondos/65ed62d6460540b6ba7ec5109246a0e6.jpg', categorias:['Jes√∫s','Ovejas']},
    {id:'f36', url:'Fondos/ceedfa05939b2ba485800873bf7e0aa7.jpg', categorias:['Coraz√≥n','Fuego']},
    {id:'f37', url:'Fondos/d17a7d4b45d335a71ff6bb90708b2672.jpg', categorias:['Cruz']},
    {id:'f38', url:'Fondos/26adb6f861482429eb46b20da45869a2.jpg', categorias:['Letras','Comics']},
    {id:'f39', url:'Fondos/dac4a6111f5c9d7f5f70c7760f6f138d.jpg', categorias:['Letras','Oscuro']},
    {id:'f40', url:'Fondos/738e2b4c526dcd69945fe7eec561a8c6.jpg', categorias:['Letras','Ingles']},
    {id:'f41', url:'Fondos/7cc6c4ca8c429ca9b2d9c17357fb781a.jpg', categorias:['Jes√∫s','Paisaje']},
    {id:'f42', url:'Fondos/7148ff1ca2096b2c60d36b0042457cf4.jpg', categorias:['Letras']},
    {id:'f43', url:'Fondos/bc76dcb3aaeaf7f36de2b2d9ec7272aa.jpg', categorias:['Oscuro','Cruz']},
    {id:'f44', url:'Fondos/522166955e4a3ac07381fd2430bf1b3c.jpg', categorias:['Oscuro']},
    {id:'f45', url:'Fondos/9962bbc0b9318a0390462b444d2361f6.jpg', categorias:['Jes√∫s']},
];

function mezclar(arr) {
    const c=[...arr]; for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];} return c;
}

function obtenerCategorias() {
    const todasCategorias = new Set();
    fondosData.forEach(f => {
        f.categorias.forEach(cat => todasCategorias.add(cat));
    });
    return [...todasCategorias].sort();
}

let categoriasSeleccionadas = [];
let zoomLevel = 1;
let currentImageUrl = '';
let currentFondoId = '';

function crear(fondo) {
    const completado = progresoManager.estaCompletado(fondo.id);
    const categoriasTexto = fondo.categorias.join(' ‚Ä¢ ');

    return `
    <div class="wallpaper-card ${completado ? 'completed' : ''}" data-id="${fondo.id}">
        
        <div class="wallpaper-image-wrapper" onclick="abrirModal('${fondo.url}', '${fondo.id}')">
            
            <img src="${fondo.url}" 
                 alt="Fondo ${categoriasTexto}" 
                 class="wallpaper-image" 
                 loading="lazy">

            <div class="stats">
                <span class="stat-item">
                    <i class="fa-solid fa-eye"></i>

                    <span id="vistas-${fondo.id}">0</span>
                </span>
                <span class="stat-item">
                <i class="fa-solid fa-download"></i>
                    <span id="descargas-${fondo.id}">0</span>
                </span>
            </div>

            <span class="wallpaper-category">${categoriasTexto}</span>
        </div>

        <div class="checkbox-wrapper-wallpaper">
            <input type="checkbox" id="${fondo.id}" ${completado ? 'checked' : ''}>
            <label for="${fondo.id}">
                ${completado ? '‚úì Guardado' : 'Marcar como guardado'}
            </label>
        </div>
    </div>`;
}



function render() {
    const g=document.getElementById('fondos-grid'),r=document.getElementById('results-count');
    
    let f=fondosData.filter(fondo=>{
    if (categoriasSeleccionadas.length === 0) return true;
    return fondo.categorias.some(cat => categoriasSeleccionadas.includes(cat));
});

// Separar completados y no completados
const nc = f.filter(c => !progresoManager.estaCompletado(c.id));
const co = f.filter(c => progresoManager.estaCompletado(c.id));

// Obtener tipo de ordenamiento
const sortType = document.getElementById('sort-select')?.value || 'default';

if (sortType === 'most-viewed') {
    // Ordenar por m√°s vistas
    nc.sort((a, b) => {
        const statsA = window._fondosStatsCache[a.id] || { vistas: 0 };
        const statsB = window._fondosStatsCache[b.id] || { vistas: 0 };
        return statsB.vistas - statsA.vistas;
    });
    co.sort((a, b) => {
        const statsA = window._fondosStatsCache[a.id] || { vistas: 0 };
        const statsB = window._fondosStatsCache[b.id] || { vistas: 0 };
        return statsB.vistas - statsA.vistas;
    });
} else if (sortType === 'most-downloaded') {
    // Ordenar por m√°s descargas
    nc.sort((a, b) => {
        const statsA = window._fondosStatsCache[a.id] || { descargas: 0 };
        const statsB = window._fondosStatsCache[b.id] || { descargas: 0 };
        return statsB.descargas - statsA.descargas;
    });
    co.sort((a, b) => {
        const statsA = window._fondosStatsCache[a.id] || { descargas: 0 };
        const statsB = window._fondosStatsCache[b.id] || { descargas: 0 };
        return statsB.descargas - statsA.descargas;
    });
} else {
    // Orden aleatorio (por defecto)
    nc.splice(0, nc.length, ...mezclar(nc));
    co.splice(0, co.length, ...mezclar(co));
}

f = [...nc, ...co];
    
    if(!f.length){
        g.innerHTML='<p style="text-align:center;color:var(--text-secondary);padding:3rem;">No se encontraron fondos</p>';
        r.textContent='';
    }else{
        g.innerHTML=f.map(crear).join('');
        // üî• VOLVER A ESCUCHAR LOS CAMBIOS PARA LOS FONDOS VISIBLES
        f.forEach(fondo => {
            cargarEstadisticas(fondo.id);
        });

        r.textContent=`${f.length} fondo${f.length!==1?'s':''} disponible${f.length!==1?'s':''}`;
        
g.querySelectorAll('.checkbox-wrapper-wallpaper input').forEach(cb => {
            cb.addEventListener('change',e=>{
                const card=e.target.closest('.wallpaper-card'),fondoId=card.dataset.id;
                const fondo=fondosData.find(f=>f.id===fondoId),label=e.target.nextElementSibling;
                if(e.target.checked){
                    if(progresoManager.marcarCompletado(fondoId,`Fondo ${fondo.categorias.join(' ‚Ä¢ ')}`,'fondos')){
                        card.classList.add('completed');label.textContent='‚úì Guardado';
                        mostrarNotificacion('¬°Fondo marcado! üñºÔ∏è');render();
                    }
                }else{
                    if(progresoManager.desmarcarCompletado(fondoId)){
                        card.classList.remove('completed');label.textContent='Marcar como guardado';
                        mostrarNotificacion('Fondo desmarcado');render();
                    }
                }
            });
        });
    }
    
    actualizarChips();
    actualizarTextoBoton();
}

function abrirModal(url, fondoId) {
    currentImageUrl = url;
    currentFondoId = fondoId;

    if (typeof window.registrarVista === 'function') {
        window.registrarVista(fondoId);
    }

    document.getElementById('modal-image').src = url;
    document.getElementById('modal-overlay').classList.add('show');
    document.body.style.overflow = 'hidden';
    zoomLevel = 1;
    document.getElementById('modal-image').style.transform = `scale(${zoomLevel})`;
}


document.getElementById('btn-close-modal').addEventListener('click', () => {
    document.getElementById('modal-overlay').classList.remove('show');
    document.body.style.overflow = '';
});

document.getElementById('modal-overlay').addEventListener('click', (e) => {
    if (e.target.id === 'modal-overlay') {
        document.getElementById('modal-overlay').classList.remove('show');
        document.body.style.overflow = '';
    }
});

document.getElementById('modal-download').addEventListener('click', () => {
    if (typeof window.registrarDescarga === 'function') {
        window.registrarDescarga(currentFondoId);
    }

    const a = document.createElement('a');
    a.href = currentImageUrl;
    a.download = 'exceso-de-luz-wallpaper.jpg';
    a.click();
    mostrarNotificacion('üì• Descargando fondo...');
});


document.getElementById('modal-image-container').addEventListener('wheel', (e) => {
    e.preventDefault();
    const img = document.getElementById('modal-image');
    if (e.deltaY < 0) {
        zoomLevel = Math.min(zoomLevel + 0.1, 3);
    } else {
        zoomLevel = Math.max(zoomLevel - 0.1, 1);
    }
    img.style.transform = `scale(${zoomLevel})`;
});

let initialDistance = 0;
document.getElementById('modal-image-container').addEventListener('touchstart', (e) => {
    if (e.touches.length === 2) {
        initialDistance = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );
    }
});

document.getElementById('modal-image-container').addEventListener('touchmove', (e) => {
    if (e.touches.length === 2) {
        e.preventDefault();
        const currentDistance = Math.hypot(
            e.touches[0].pageX - e.touches[1].pageX,
            e.touches[0].pageY - e.touches[1].pageY
        );
        const img = document.getElementById('modal-image');
        zoomLevel = Math.min(Math.max((currentDistance / initialDistance) * zoomLevel, 1), 3);
        img.style.transform = `scale(${zoomLevel})`;
    }
});

function actualizarChips() {
    const c=document.getElementById('active-filters');c.innerHTML='';
    categoriasSeleccionadas.forEach(cat=>{
        const ch=document.createElement('div');ch.className='filter-chip';
        ch.innerHTML=`<span>${cat}</span><span class="filter-chip-close" data-valor="${cat}">√ó</span>`;
        c.appendChild(ch);
    });
    c.querySelectorAll('.filter-chip-close').forEach(btn=>{
        btn.addEventListener('click',()=>{
            categoriasSeleccionadas=categoriasSeleccionadas.filter(x=>x!==btn.dataset.valor);
            renderCategorias();render();
        });
    });
}

function slugify(str) {
  return String(str).trim().toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-_]/g, '');
}

function renderCategorias() {
    const menu = document.getElementById('categoria-menu');
    const categorias = obtenerCategorias();
    // Crear markup con IDs "seguros"
    menu.innerHTML = categorias.map(c => {
        const idSafe = `cat-${slugify(c)}`;
        return `
        <div class="filter-option ${categoriasSeleccionadas.includes(c)?'selected':''}" data-valor="${c}">
            <input type="checkbox" id="${idSafe}" ${categoriasSeleccionadas.includes(c)?'checked':''}>
            <label for="${idSafe}">${c}</label>
        </div>
    `;
    }).join('');

    // Listeners
    menu.querySelectorAll('.filter-option').forEach(opt => {
        const checkbox = opt.querySelector('input');
        const label = opt.querySelector('label');

        // Clic en toda la opci√≥n (no solo en label)
        opt.addEventListener('click', (e) => {
            // evitar que el click en el men√∫ cierre por el listener global
            e.stopPropagation();
            // si clicke√≥ directamente la checkbox, el input cambiar√° su estado, si no, toggle manual
            if (e.target === checkbox) {
                // deja que el change maneje toggleCategoria
                return;
            } else {
                checkbox.checked = !checkbox.checked;
            }
            toggleCategoria(opt.dataset.valor);
        });

        // Cambios directos en checkbox (ej. accesibilidad / teclado)
        checkbox.addEventListener('change', (e) => {
            e.stopPropagation();
            toggleCategoria(opt.dataset.valor);
        });
    });
}


function toggleCategoria(cat) {
    if (categoriasSeleccionadas.includes(cat)) {
        categoriasSeleccionadas = categoriasSeleccionadas.filter(x => x !== cat);
    } else {
        categoriasSeleccionadas.push(cat);
    }
    renderCategorias();
    render();
}

function actualizarTextoBoton() {
    const btn = document.getElementById('categoria-toggle');
    if (categoriasSeleccionadas.length === 0) {
        btn.textContent = 'Categor√≠a (todas)';
    } else if (categoriasSeleccionadas.length === 1) {
        btn.textContent = `Categor√≠a: ${categoriasSeleccionadas[0]}`;
    } else {
        btn.textContent = `Categor√≠a (${categoriasSeleccionadas.length})`;
    }
}

// Inicializar cache global
window._fondosStatsCache = window._fondosStatsCache || {};

function cargarEstadisticas(fondoId) {
    if (typeof window.escucharCambios === 'function') {
        window.escucharCambios(fondoId, (data) => {
            // Guardar en cache
            window._fondosStatsCache[fondoId] = {
                vistas: data.vistas || 0,
                descargas: data.descargas || 0
            };
            
            // Actualizar DOM
            const vistasEl = document.getElementById(`vistas-${fondoId}`);
            const descargasEl = document.getElementById(`descargas-${fondoId}`);
            
            if (vistasEl) vistasEl.textContent = data.vistas || 0;
            if (descargasEl) descargasEl.textContent = data.descargas || 0;
        });
    }
}

document.addEventListener('DOMContentLoaded', () => {
    if (typeof guardarConteoCategoria === 'function') {
        guardarConteoCategoria('fondos', fondosData.length);
    }
    
    renderCategorias();
    render();
    
    fondosData.forEach(fondo => {
        cargarEstadisticas(fondo.id);
    });
    
    document.getElementById('categoria-toggle').addEventListener('click', (e) => {
    e.stopPropagation(); // importante: evita que el click se propague y el document lo cierre
    const menu = document.getElementById('categoria-menu');
    const btn = document.getElementById('categoria-toggle');
    // si otro menu est√° abierto, cerrarlo
    document.querySelectorAll('.filter-menu').forEach(m => {
        if (m !== menu) m.classList.remove('show');
    });
    document.querySelectorAll('.filter-btn-toggle').forEach(b => {
        if (b !== btn) b.classList.remove('active');
    });
    menu.classList.toggle('show');
    btn.classList.toggle('active');

    // Opcional: asegura foco dentro para navegaci√≥n por teclado
    if (menu.classList.contains('show')) {
        const firstInput = menu.querySelector('input');
        if (firstInput) firstInput.focus();
    }
});

    
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.filter-dropdown')) {
            document.querySelectorAll('.filter-menu').forEach(m => m.classList.remove('show'));
            document.querySelectorAll('.filter-btn-toggle').forEach(b => b.classList.remove('active'));
        }
    });
    
    if (typeof iniciarScrollHeader === 'function') iniciarScrollHeader();
    // Selector de ordenamiento
    document.getElementById('sort-select').addEventListener('change', () => {
        render();
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // GRID INTELIGENTE - Autom√°tico + Manual
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function aplicarColumnas(cols, manual = false) {
        const grid = document.getElementById('fondos-grid');
        if (!grid) return;
        
        if (manual) {
            grid.setAttribute('data-user-choice', cols);
            grid.style.setProperty('--user-grid-columns', `repeat(${cols}, 1fr)`);
            localStorage.setItem('fondos-grid-cols', cols);
            localStorage.setItem('fondos-grid-manual', 'true');
            console.log('‚úÖ Usuario eligi√≥:', cols, 'columnas');
        } else {
            grid.removeAttribute('data-user-choice');
            grid.style.removeProperty('--user-grid-columns');
            console.log('üîÑ Grid autom√°tico activado');
        }
        
        document.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
        if (cols) {
            const btnActivo = document.querySelector(`.grid-btn[data-cols="${cols}"]`);
            if (btnActivo) btnActivo.classList.add('active');
        }
    }

    document.querySelectorAll('.grid-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const cols = btn.dataset.cols;
            aplicarColumnas(cols, true);
        });
    });

    const savedCols = localStorage.getItem('fondos-grid-cols');
    const esManual = localStorage.getItem('fondos-grid-manual') === 'true';
    
    if (esManual && savedCols) {
        setTimeout(() => aplicarColumnas(savedCols, true), 100);
    } else {
        aplicarColumnas(null, false);
    }
    
    if (typeof iniciarScrollHeader === 'function') iniciarScrollHeader();
});


    </script>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, 
  doc, 
  setDoc, 
  updateDoc, 
  increment, 
  onSnapshot 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyARYSgelNGVVpOryuq0Z3YCZxoqYA8TUns",
  authDomain: "exceso-de-luz.firebaseapp.com",
  projectId: "exceso-de-luz",
  storageBucket: "exceso-de-luz.firebasestorage.app",
  messagingSenderId: "442481525938",
  appId: "1:442481525938:web:e72a2672a589e594aeb5ab",
  measurementId: "G-GLTKTGY2GG"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.registrarVista = async function(fondoId) {
  try {
    const fondoRef = doc(db, "fondos", fondoId);
    await setDoc(fondoRef, {
      vistas: increment(1),
      ultimaActualizacion: new Date()
    }, { merge: true });
    console.log('Vista registrada:', fondoId);
  } catch (error) {
    console.error("Error registrando vista:", error);
  }
};

window.registrarDescarga = async function(fondoId) {
  try {
    const fondoRef = doc(db, "fondos", fondoId);
    await setDoc(fondoRef, {
      descargas: increment(1),
      ultimaActualizacion: new Date()
    }, { merge: true });
    console.log('Descarga registrada:', fondoId);
  } catch (error) {
    console.error("Error registrando descarga:", error);
  }
};

window.escucharCambios = function(fondoId, callback) {
  const fondoRef = doc(db, "fondos", fondoId);
  
  onSnapshot(fondoRef, (docSnap) => {
    if (docSnap.exists()) {
      callback(docSnap.data());
    } else {
      callback({ vistas: 0, descargas: 0 });
    }
  });
};

console.log("üî• Sistema de estad√≠sticas conectado");
</script>

</body>
</html>