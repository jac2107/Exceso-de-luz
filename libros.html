<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libros - Exceso de Luz</title>
    <link rel="stylesheet" href="exceso_de_luz.css">
    <style>
        .home-minimal {
            position: fixed;
            top: 18px; left: 18px;
            font-size: 0.85rem; font-weight: 500;
            color: rgba(0,0,0,0.85);
            text-decoration: none;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(6px);
            padding: 8px 14px;
            border-radius: 999px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            opacity: 0; pointer-events: none;
            transform: translateY(-6px);
            transition: opacity .25s ease, transform .25s ease, box-shadow .25s ease;
            z-index: 999;
        }
        .home-minimal.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .home-minimal:hover { background: rgba(255,248,235,0.95); box-shadow: 0 10px 24px rgba(0,0,0,0.18); }
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CONTROLES Y FILTROS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .books-controls {
            background: var(--bg-card);
            padding: clamp(1.5rem, 3vw, 2rem);
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .filter-dropdown {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .filter-btn-toggle {
            width: 100%;
            padding: 0.8rem 3rem 0.8rem 1rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .filter-btn-toggle:hover {
            border-color: var(--primary-color);
        }

        .filter-btn-toggle.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .filter-btn-toggle::after {
            content: 'â–¼';
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .filter-btn-toggle.active::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .filter-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 280px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .filter-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .filter-option {
            padding: 0.7rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-option:last-child {
            border-bottom: none;
        }

        .filter-option:hover {
            background: var(--color-beige);
        }

        .filter-option.selected {
            background: linear-gradient(135deg, 
                rgba(215, 204, 200, 0.3) 0%, 
                rgba(239, 235, 233, 0.2) 100%);
            font-weight: 600;
        }

        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            user-select: none;
        }

        .sort-select {
            padding: 0.7rem 2rem 0.7rem 0.8rem;
            background: var(--bg-main);
            border: 1.5px solid var(--border-color);
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.6rem center;
            min-width: 160px;
            flex-shrink: 0;
        }

        .sort-select:hover {
            border-color: var(--primary-color);
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 64, 55, 0.1);
        }

        .active-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            min-height: 24px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary-color);
            color: var(--color-blanco);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: chipIn 0.3s ease;
        }

        @keyframes chipIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .filter-chip-close {
            cursor: pointer;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .filter-chip-close:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.8rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TARJETAS DE LIBRO CON DISEÃ‘O 3D
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .book-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s ease;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 35px rgba(93, 64, 55, 0.25);
        }

        /* Contenedor del libro 3D */
        .book-cover-wrapper {
            position: relative;
            width: 100%;
            padding-top: 140%; /* ProporciÃ³n de libro vertical */
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            overflow: hidden;
            perspective: 1000px;
        }

        /* Libro 3D con efecto de profundidad */
        .book-3d {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 75%;
            height: 85%;
            transform: translate(-50%, -50%) rotateY(-15deg);
            transform-style: preserve-3d;
            transition: transform 0.6s ease;
        }

        .book-card:hover .book-3d {
            transform: translate(-50%, -50%) rotateY(-5deg) translateZ(20px);
        }

        /* Portada del libro */
        .book-front {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                var(--primary-color) 0%, 
                var(--color-marron) 100%);
            border-radius: 8px 2px 2px 8px;
            box-shadow: 
                -10px 0 20px rgba(0,0,0,0.2),
                inset -3px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            text-align: center;
            color: white;
        }

        /* Lomo del libro */
        .book-spine {
            position: absolute;
            left: -12px;
            top: 0;
            width: 12px;
            height: 100%;
            background: linear-gradient(to right, 
                rgba(0,0,0,0.3) 0%, 
                rgba(0,0,0,0.1) 100%);
            transform: rotateY(-90deg);
            transform-origin: right center;
        }

        /* TÃ­tulo del libro en la portada */
        .book-title-cover {
            font-size: 1.1rem;
            font-weight: 800;
            line-height: 1.3;
            margin-bottom: 0.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-author-cover {
            font-size: 0.8rem;
            font-weight: 500;
            opacity: 0.9;
            margin-top: auto;
        }

        /* Icono decorativo */
        .book-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Stats mini en la portada */
        .book-stats {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.741);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 15px;
            z-index: 10;
        }

        .book-stats i {
            font-size: 12px;
        }

        .book-stat-number {
            font-weight: 700;
            color: rgb(0, 0, 0);
        }

        /* Tema/categorÃ­a */
        .book-theme {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.9);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
        }

        /* InformaciÃ³n del libro */
        .book-info {
            padding: 1.3rem;
        }

        .book-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-author {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.8rem;
        }

        .book-synopsis {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-actions {
            display: flex;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }

        .book-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-download {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .btn-download:hover {
            background: linear-gradient(135deg, #388E3C 0%, #2E7D32 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        /* Checkbox */
        .checkbox-wrapper-book {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .checkbox-wrapper-book input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success-color);
        }

        .checkbox-wrapper-book label {
            font-size: 0.88rem;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
            font-weight: 500;
        }

        .checkbox-wrapper-book input:checked + label {
            color: var(--success-color);
            font-weight: 600;
        }

        /* Badge completado */
        .completed-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6D4C41 0%, #4E342E 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.3rem;
            z-index: 15;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            animation: badgePop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes badgePop {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.3) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* Tarjeta completada */
        .book-card.completed {
    filter: grayscale(40%) brightness(0.9);
}

        .book-card.completed::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    pointer-events: none;
    background: rgba(0,0,0,0.25);
    backdrop-filter: grayscale(30%);
}
 

        /* Modal de sinopsis */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: var(--bg-main);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--primary-color);
            color: white;
            transform: rotate(90deg);
        }

        .modal-book-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .modal-book-author {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .modal-book-synopsis {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .filter-section {
                flex-direction: column;
            }
            
            .filter-dropdown,
            .sort-select {
                min-width: 100%;
            }

            .book-title-cover {
                font-size: 0.95rem;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }
        }
       /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIBRO QUE SE CIERRA AL HOVER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-cover-wrapper {
    position: relative;
    width: 100%;
    padding-top: 140%;
    background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
    overflow: hidden;
    perspective: 1200px;
}

.book-3d {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 85%;
    height: 92%;
    transform: translate(-50%, -50%);
    transform-style: preserve-3d;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PORTADA COMPLETA (ESTADO INICIAL - ABIERTO)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-cover-art {
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    border-radius: 8px;
    box-shadow: 
        0 10px 40px rgba(0,0,0,0.4),
        inset 0 1px 3px rgba(255,255,255,0.1);
    z-index: 5;
    transition: opacity 0.4s ease, transform 0.6s ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PÃGINAS INTERIORES (visibles al cerrar)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-pages-container {
    position: absolute;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    opacity: 0;
    transition: opacity 0.3s ease;
}

/* PÃ¡gina individual */
.book-page {
    position: absolute;
    width: 96%;
    height: 96%;
    left: 2%;
    top: 2%;
    background: linear-gradient(to right, 
        #fafafa 0%, 
        #ffffff 50%, 
        #fafafa 100%);
    border-radius: 4px;
    transform-origin: left center;
    box-shadow: 
        2px 0 6px rgba(0,0,0,0.15),
        inset -2px 0 4px rgba(0,0,0,0.08);
    transform: rotateY(0deg);
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* LÃ­neas de texto en las pÃ¡ginas */
.book-page::before {
    content: '';
    position: absolute;
    inset: 8%;
    background-image: repeating-linear-gradient(
        transparent 0px,
        transparent 11px,
        rgba(0,0,0,0.08) 11px,
        rgba(0,0,0,0.08) 12px
    );
    border-left: 20px solid rgba(0,0,0,0.02);
}

/* MÃºltiples pÃ¡ginas para efecto de grosor (12 pÃ¡ginas) */
.book-page:nth-child(1)  { z-index: 12; background: #fefefe; }
.book-page:nth-child(2)  { z-index: 11; opacity: 0.98; }
.book-page:nth-child(3)  { z-index: 10; opacity: 0.96; }
.book-page:nth-child(4)  { z-index: 9;  opacity: 0.94; }
.book-page:nth-child(5)  { z-index: 8;  opacity: 0.92; background: #fafafa; }
.book-page:nth-child(6)  { z-index: 7;  opacity: 0.90; }
.book-page:nth-child(7)  { z-index: 6;  opacity: 0.88; }
.book-page:nth-child(8)  { z-index: 5;  opacity: 0.86; }
.book-page:nth-child(9)  { z-index: 4;  opacity: 0.84; background: #f8f8f8; }
.book-page:nth-child(10) { z-index: 3;  opacity: 0.82; }
.book-page:nth-child(11) { z-index: 2;  opacity: 0.80; }
.book-page:nth-child(12) { z-index: 1;  opacity: 0.78; background: #f5f5f5; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAPAS DEL LIBRO (contraportada y portada cerrada)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-back-cover {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        var(--color-marron) 0%, 
        var(--primary-color) 100%);
    border-radius: 8px 4px 4px 8px;
    z-index: 0;
    box-shadow: 
        -4px 0 12px rgba(0,0,0,0.3),
        inset 3px 0 6px rgba(0,0,0,0.2);
}

.book-front-cover {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        var(--primary-color) 0%, 
        var(--color-marron) 100%);
    border-radius: 4px 8px 8px 4px;
    transform-origin: left center;
    transform: rotateY(0deg);
    z-index: 6;
    opacity: 0;
    box-shadow: 
        -4px 0 15px rgba(0,0,0,0.4),
        inset -3px 0 6px rgba(0,0,0,0.2);
    transition: opacity 0.3s ease, transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
}

.book-front-cover .book-title-cover {
    font-size: 1.1rem;
    font-weight: 800;
    color: white;
    text-align: center;
    text-shadow: 0 2px 8px rgba(0,0,0,0.6);
    line-height: 1.3;
    margin-bottom: 0.8rem;
}

.book-front-cover .book-author-cover {
    font-size: 0.85rem;
    color: rgba(255,255,255,0.9);
    font-weight: 600;
}

.book-front-cover .book-icon {
    font-size: 2rem;
    opacity: 0.3;
    margin-bottom: 1rem;
}


@keyframes fadeInCover {
    0% {
        opacity: 0;
        transform: scale(0.95);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EFECTO DE BRILLO DURANTE EL CICLO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-card:hover .book-cover-art::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        120deg,
        transparent 30%,
        rgba(255,255,255,0.3) 50%,
        transparent 70%
    );
    animation: shine 1.7s ease;
    pointer-events: none;
    border-radius: 8px;
}

@keyframes shine {
    0% {
        transform: translateX(-100%) rotate(45deg);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    20% {
        transform: translateX(100%) rotate(45deg);
        opacity: 0;
    }
    80% {
        opacity: 0;
    }
    90% {
        opacity: 1;
        transform: translateX(-100%) rotate(45deg);
    }
    100% {
        transform: translateX(100%) rotate(45deg);
        opacity: 0;
    }
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOMO DEL LIBRO (visible al cerrarse)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-spine {
    position: absolute;
    width: 20px;
    height: 100%;
    left: -10px;
    top: 0;
    background: linear-gradient(to right,
        rgba(0,0,0,0.4) 0%,
        rgba(0,0,0,0.2) 50%,
        rgba(0,0,0,0.1) 100%);
    transform: rotateY(-90deg);
    transform-origin: right center;
    z-index: 0;
    border-radius: 4px 0 0 4px;
}

.book-spine::after {
    content: attr(data-title);
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) rotate(-90deg);
    font-size: 0.7rem;
    font-weight: 700;
    color: rgba(255,255,255,0.8);
    white-space: nowrap;
    max-width: 90%;
    overflow: hidden;
    text-overflow: ellipsis;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SOMBRA DINÃMICA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.book-3d::after {
    content: '';
    position: absolute;
    bottom: -8%;
    left: 5%;
    width: 90%;
    height: 15px;
    background: radial-gradient(ellipse, rgba(0,0,0,0.4) 0%, transparent 70%);
    transform: scaleY(0.5);
    transition: all 0.6s ease;
}
/* --- Hover simple: ligera inclinaciÃ³n + brillo suave --- */
.book-card:hover .book-3d {
  transform: translate(-50%, -50%) rotateY(-6deg) rotateZ(-2deg) translateZ(14px);
  transition: transform 420ms cubic-bezier(.22,.9,.32,1);
}

/* portada se eleva y gana brillo */
.book-card:hover .book-cover-art {
  transform: scale(1.035) translateY(-4px);
  filter: brightness(1.06) saturate(1.03);
  transition: transform 420ms cubic-bezier(.22,.9,.32,1), filter 260ms ease;
}

/* overlay de iluminaciÃ³n suave (usa misma pseudo si ya existe, si no, lo crea) */
.book-cover-art::after{
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 8px;
  pointer-events: none;
  background: linear-gradient(120deg,
             rgba(255,255,255,0.00) 0%,
             rgba(255,255,255,0.06) 35%,
             rgba(255,255,255,0.00) 70%);
  opacity: 0;
  transform: translateX(-14%);
  transition: opacity 360ms ease, transform 480ms cubic-bezier(.22,.9,.32,1);
  z-index: 6;
}

/* mostrar el overlay al hacer hover */
.book-card:hover .book-cover-art::after {
  opacity: 1;
  transform: translateX(14%);
}

/* aseguramos que las pÃ¡ginas interiores no aparezcan (si preferÃ­s ocultarlas por seguridad) */
.book-pages-container { opacity: 0 !important; pointer-events: none !important; }
.book-front-cover { opacity: 0 !important; pointer-events: none !important; }
    </style>
    
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none;">
                    <h1>âœ¨ Exceso de Luz</h1>
                    <p class="tagline">Ilumina tu camino espiritual</p>
                </a>
            </div>
            <a href="index.html" class="btn-back">â† Volver</a>
        </div>
    </header>

    <main class="main-container">
        <div class="container">
            <div class="page-header">
                <div class="page-icon">ğŸ“š</div>
                <h2>Libros Cristianos</h2>
                <p>Descubre lecturas que transformarÃ¡n tu vida espiritual</p>
            </div>

            <div class="books-controls">
                <div class="filter-section">
                    <div class="filter-dropdown">
                        <button class="filter-btn-toggle" id="autor-toggle">
                            Autor (todos)
                        </button>
                        <div class="filter-menu" id="autor-menu"></div>
                    </div>

                    <div class="filter-dropdown">
                        <button class="filter-btn-toggle" id="tema-toggle">
                            Tema (todos)
                        </button>
                        <div class="filter-menu" id="tema-menu"></div>
                    </div>

                    <select id="sort-select" class="sort-select">
                        <option value="default">Por defecto</option>
                        <option value="most-read">ğŸ“– MÃ¡s leÃ­dos</option>
                        <option value="most-downloaded">ğŸ“¥ MÃ¡s descargados</option>
                    </select>
                </div>

                <div class="active-filters" id="active-filters"></div>
                <div class="results-count" id="results-count"></div>
            </div>

            <div class="resource-grid" id="libros-grid"></div>
        </div>
    </main>

    <!-- Modal de sinopsis -->
    <div class="modal-overlay" id="modal-synopsis">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">Ã—</button>
            <h3 class="modal-book-title" id="modal-title"></h3>
            <p class="modal-book-author" id="modal-author"></p>
            <p class="modal-book-synopsis" id="modal-synopsis-text"></p>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Exceso de Luz</p>
            <p class="verse">"LÃ¡mpara es a mis pies tu palabra" â€” Salmos 119:105</p>
        </div>
    </footer>
<a href="index.html" class="home-minimal" aria-label="Volver al inicio">ğŸ¡° Volver</a>
r
    <script src="exceso_de_luz.js"></script>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, increment, onSnapshot, runTransaction, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyARYSgelNGVVpOryuq0Z3YCZxoqYA8TUns",
  authDomain: "exceso-de-luz.firebaseapp.com",
  projectId: "exceso-de-luz",
  storageBucket: "exceso-de-luz.firebasestorage.app",
  messagingSenderId: "442481525938",
  appId: "1:442481525938:web:e72a2672a589e594aeb5ab",
  measurementId: "G-GLTKTGY2GG"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window._booksStatsCache = window._booksStatsCache || {};

window.registrarLectura = async function(libroId) {
  try {
    const libroRef = doc(db, 'libros', libroId);
    await setDoc(libroRef, {
      leidos: increment(1),
      ultimaLectura: new Date()
    }, { merge: true });
    console.log('âœ… Lectura registrada:', libroId);
  } catch(err) {
    console.error('âŒ Error registrarLectura', err);
  }
};

window.registrarDescargaLibro = async function(libroId) {
  try {
    const libroRef = doc(db, 'libros', libroId);
    await setDoc(libroRef, {
      descargas: increment(1),
      ultimaDescarga: new Date()
    }, { merge: true });
    console.log('âœ… Descarga registrada:', libroId);
  } catch(err) {
    console.error('âŒ Error registrarDescarga', err);
  }
};

window.desregistrarLectura = async function(libroId) {
  try {
    const libroRef = doc(db, 'libros', libroId);
    await runTransaction(db, async (tx) => {
      const snap = await tx.get(libroRef);
      const current = (snap.exists() && typeof snap.data().leidos === 'number') ? snap.data().leidos : 0;
      const nuevo = Math.max(0, current - 1);
      // Usa update via transaction para evitar condiciones de carrera
      tx.set(libroRef, { leidos: nuevo }, { merge: true });
    });
    console.log('âœ… Lectura desregistrada:', libroId);
  } catch (err) {
    console.error('âŒ Error desregistrarLectura', err);
  }
};

window.escucharCambiosLibro = function(libroId, callback) {
  const libroRef = doc(db, 'libros', libroId);
  onSnapshot(libroRef, snap => {
    const data = snap.exists() ? snap.data() : {};
    const stats = {
      leidos: data.leidos || 0,
      descargas: data.descargas || 0
    };
    window._booksStatsCache[libroId] = stats;
    callback(stats);
  }, err => console.error('âŒ snapshot error', err));
};

console.log('ğŸ”¥ Firebase libros stats ready');
</script>
    <script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATOS DE LIBROS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const librosData = [
  
  {
    id: 'l1',
    titulo: 'El noviazgo',
    autor: 'The Gospel Coalition (TGC)',
    tema: 'Relaciones y Vida PrÃ¡ctica',
    sinopsis: 'Â¿EstÃ¡s construyendo una relaciÃ³n para un rato o para toda la vida? Deja de jugar a las "parejitas" y empieza a construir un legado bajo el diseÃ±o de Dios. Este libro es una hoja de ruta seria para pasar del simple "me gusta" a un compromiso con propÃ³sito eterno.',
    urlDescarga: 'Libros/01.-El-noviazgo-Autor-Thegospelcoalition.pdf',
    cover: 'https://media.thegospelcoalition.org/wp-content/uploads/sites/4/2020/11/09170531/El_Noviazgo_eBook.png'
  },
  {
    id: 'l2',
    titulo: 'El Campo de Batalla de la Mente',
    autor: 'Joyce Meyer',
    tema: 'Fortaleza Mental y Espiritual',
    sinopsis: 'Tu mente es el territorio mÃ¡s disputado del universo y el enemigo no quiere que lo sepas. Joyce Meyer te entrega las armas para identificar las mentiras que te detienen y recuperar tu paz. Â¿EstÃ¡s listo para ganar la guerra que se libra en tus pensamientos?',
    urlDescarga: 'Libros/El Campo de Batalla de la Mente PDF.pdf',
    cover: 'https://cdn.slidesharecdn.com/ss_thumbnails/520712271-el-campo-de-batalla-de-la-mente-joyce-meyer-241014170644-488dfe02-thumbnail.jpg?width=640&height=640&fit=bounds'
  },
  {
    id: 'l3',
    titulo: 'Conocer a Dios',
    autor: 'J.I Packer',
    tema: 'Fundamentos y TeologÃ­a',
    sinopsis: 'Â¿Conoces a Dios o solo sabes "datos curiosos" sobre Ã‰l? Hay una diferencia abismal entre la teorÃ­a y una relaciÃ³n vibrante con el Creador. Packer te saca de la orilla de la religiÃ³n superficial y te lanza a las profundidades de Su carÃ¡cter. Es hora de que tu fe tenga raÃ­ces reales.',
    urlDescarga: 'Libros/841841819-Conocer-a-Dios-J-I-Packer.pdf',
    cover: 'https://images.cdn1.buscalibre.com/fit-in/360x360/a3/5e/a35ee517b063e3cf66beb062cde99cd3.jpg'
  },
  {
    id: 'l4',
    titulo: 'Las Pasiones del CorazÃ³n de Dios',
    autor: 'Mariano Sennewald',
    tema: 'Intimidad y Avivamiento',
    sinopsis: 'Cuidado: este libro puede incendiar tu rutina espiritual. Mariano te invita a dejar de pedirle cosas a Dios para empezar a sentir lo que Ã‰l siente. AlÃ­nea tu corazÃ³n con Sus deseos mÃ¡s profundos y conviÃ©rtete en un eco de Su pasiÃ³n en la tierra. Â¿Te atreves a arder por lo mismo que el Cielo?',
    urlDescarga: 'Libros/ilide.info-las-pasiones-del-corazon-de-dios-mariano-sennewald-pr_da59ca96439cad1fbb694c4d2e34d1b3.pdf',
    cover: 'https://cdn.kobo.com/book-images/abd7baed-d1db-4136-85d8-5994cc92bd71/1200/1200/False/las-pasiones-del-corazon-de-dios.jpg'
  },
  {
    id: 'l5',
    titulo: 'Hijos de la Intimidad',
    autor: 'Mariano Sennewald',
    tema: 'Intimidad y Avivamiento',
    sinopsis: 'Basta de agotarte intentando impresionar a Dios con tus obras. Tu mayor logro no es lo que haces para Ã‰l, sino el tiempo que pasas con Ã‰l en secreto. Descubre el descanso radical de ser simplemente un hijo que conoce la voz de su Padre y vive desde Su presencia.',
    urlDescarga: 'Libros/ilide.info-hijos-de-la-intimidad-pr_17f547e6003121b1072a72e9867854ba.pdf',
    cover: 'https://imgv2-1-f.scribdassets.com/img/document/836160725/original/2f1c8160e6/1?v=1'
  },
  {
    id: 'l6',
    titulo: 'Dibuja el CÃ­rculo',
    autor: 'Mark Betterson',
    tema: 'Intimidad y Avivamiento',
    sinopsis: 'Â¿Tus oraciones son seguras y aburridas o son audaces y persistentes? Batterson te lanza el reto de tu vida: no dejes de orar hasta ver la promesa cumplida. Aprende a "dibujar cÃ­rculos" de fe alrededor de tus problemas y no te muevas de ahÃ­ hasta que los muros caigan.',
    urlDescarga: 'Libros/ilide.info-dibuja-el-circulo-pdf-pr_16b5c45c1134c2584106d91a1da30544.pdf',
    cover: 'https://img1.od-cdn.com/ImageType-400/0354-1/%7B997A6256-DD89-4B05-8AC5-1F57CE4CB93D%7DIMG400.JPG'
  },
  {
    id: 'l7',
    titulo: 'Invisibles',
    autor: 'Fabian Liendo',
    tema: 'Fortaleza Mental y Espiritual',
    sinopsis: 'Para el que se siente un nÃºmero mÃ¡s en la multitud: Dios tiene una obsesiÃ³n contigo. FabiÃ¡n Liendo desenmascara las mentiras del rechazo y la soledad para mostrarte que eres el tesoro mÃ¡s visible del cielo. Â¿DejarÃ¡s que el Padre sane hoy tus heridas de identidad?',
    urlDescarga: 'Libros/863907195-Fabian-Liendo-INVISIBLES-1.pdf',
    cover: 'https://images.cdn3.buscalibre.com/fit-in/360x360/eb/67/eb67b7ee38ee071418d32574012ee5aa.jpg'
  },
  {
    id: 'l8',
    titulo: 'Explorando el Antiguo Testamento',
    autor: 'C. E. Demaray y W. T. Purkise',
    tema: 'Fundamentos y TeologÃ­a',
    sinopsis: 'OlvÃ­date de ver el Antiguo Testamento como un laberinto de leyes aburridas. Descubre cÃ³mo cada profecÃ­a y cada historia son piezas de un rompecabezas que apuntan directamente a JesÃºs. Si quieres entender el "porquÃ©" de tu fe, tienes que conocer el origen de la promesa.',
    urlDescarga: 'Libros/ilide.info-explorando-el-antiguo-testamento-pr_172dea1037d95adbd8223ff258228218.pdf',
    cover: 'https://imgv2-2-f.scribdassets.com/img/document/655731895/original/556a69e3d0/1?v=1'
  },
  {
    id: 'l9',
    titulo: 'Una Vida con PropÃ³sito',
    autor: 'Rick Warren',
    tema: 'Relaciones y Vida PrÃ¡ctica',
    sinopsis: 'No eres un accidente biolÃ³gico ni un error del destino. En solo 40 dÃ­as, este libro te ayudarÃ¡ a limpiar el ruido de tu vida para que escuches el propÃ³sito para el cual fuiste diseÃ±ado. Â¿EstÃ¡s listo para dejar de sobrevivir y empezar a vivir la misiÃ³n que Dios te confiÃ³?',
    urlDescarga: 'Libros/ilide.info-una-vida-con-proposito-rick-warren-version-2022-pr_8e53ee1ee497f0a6d0d484d795f531c4.pdf',
    cover: 'https://images.cdn1.buscalibre.com/fit-in/360x360/f2/0d/f20de538d45f5cc8c30c2087eeabaa5a.jpg'
  },
  
  {
    id: 'l10',
    titulo: 'Mentiras Que Los Hombres Creen',
    autor: 'Robert Wolgemuth',
    tema: 'Relaciones y Vida PrÃ¡ctica',
    sinopsis: 'Â¿Alguna vez has sentido que no eres "suficiente" como hombre, esposo o padre? Robert Wolgemuth pone sobre la mesa las mentiras culturales que han encadenado tu libertad. Es hora de romper esos mitos con la verdad bÃ­blica y descubrir el diseÃ±o real que Dios tiene para tu masculinidad. Â¿Te atreves a dejar de creer lo que el mundo dice de ti?',
    urlDescarga: 'Libros/ilide.info-mentiras-que-los-hombres-creen-y-la-verdad-que-los-hace-libres-robert-wolgemuth--pr_865ca5a071302b293e11a4bea6cc1743.pdf',
    cover: 'https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1555480313i/44891876.jpg'
  },
  {
    id: 'l11',
    titulo: 'Mentiras Que Las Mujeres Creen',
    autor: 'Nancy DeMoss Wolgemuth',
    tema: 'Relaciones y Vida PrÃ¡ctica',
    sinopsis: 'Â¿Sientes que tu felicidad depende de tus circunstancias o de los demÃ¡s? Nancy DeMoss expone con amor y firmeza las mentiras que sutilmente han robado tu paz. No es solo un libro de estudio, es un camino de liberaciÃ³n hacia la verdad que te hace plenamente libre en Cristo. Â¿EstÃ¡s lista para dejar de escuchar el engaÃ±o y abrazar Su gracia?',
    urlDescarga: 'Libros/ilide.info-mentiras-que-las-mujeres-creen-guia-de-estudio-nancy-demoss-wolgemuth-pr_841560e790a949748e4f0669135f9624.pdf',
    cover: 'https://static.clcecuador.com/_CLCEcuador/images/products/large/15033.jpg'
  },
  {
    id: 'l12',
    titulo: 'Amar es para Valientes',
    autor: 'Itiel Arroyo',
    tema: 'Relaciones y Vida PrÃ¡ctica',
    sinopsis: 'En una era de amores desechables y sentimientos lÃ­quidos, Itiel Arroyo te lanza un desafÃ­o: amar como JesÃºs. Este libro no es para cobardes que buscan comodidad, sino para valientes que estÃ¡n dispuestos a sacrificarse y comprometerse de verdad. Â¿Tienes el valor necesario para amar de la forma que el mundo ya olvidÃ³?',
    urlDescarga: 'Libros/ilide.info-amar-es-para-valientes-spanish-edition-pdf-pr_2097f9fc51e0a0feac28087a0d020281.pdf',
    cover: 'https://imgv2-2-f.scribdassets.com/img/document/456083100/original/c333ca7e93/1?v=1'
  },
  {
    id: 'l13',
    titulo: 'Gana la Guerra en tu Mente',
    autor: 'Craig Groeschel',
    tema: 'Fortaleza Mental y Espiritual',
    sinopsis: 'Tu vida siempre se mueve en la direcciÃ³n de tus pensamientos mÃ¡s fuertes. Craig Groeschel combina neurociencia y Biblia para enseÃ±arte a recablear tu cerebro. Si estÃ¡s harto de los ciclos de ansiedad y pensamientos destructivos, aquÃ­ tienes el plan de batalla para recuperar el territorio de tu mente. Â¿QuÃ© pensamientos vas a cambiar hoy?',
    urlDescarga: 'Libros/ilide.info-gana-la-guerra-en-tu-mente-pr_639f9db732b67dce8e8bce73421e0497.pdf',
    cover: 'https://desarrollocristiano.pe/wp-content/uploads/2023/01/9780829770841.jpg'
  },
  {
    id: 'l14',
    titulo: 'Victoria Sobre la Oscuridad',
    autor: 'Neil T. Anderson',
    tema: 'Fortaleza Mental y Espiritual',
    sinopsis: 'Â¿Sabes realmente quiÃ©n eres en Cristo o sigues viviendo bajo el peso de tu pasado? Neil Anderson te lleva a descubrir tu identidad espiritual para vencer las fortalezas que te mantienen atado. No permitas que la oscuridad nuble tu propÃ³sito; es hora de caminar en la luz de tu verdadera libertad como hijo de Dios.',
    urlDescarga: 'Libros/ilide.info-victoria-sobre-la-oscuridad-neil-anderson-pr_b68106b0eb3d79888fecc99a39144703.pdf',
    cover: 'https://libreriaclcperu.com/_CLCPeru/images/products/original/367.jpg'
  },
  {
    id: 'l15',
    titulo: 'Viviendo su voluntad',
    autor: 'Sebastian Franz',
    tema: 'Intimidad y Avivamiento',
    sinopsis: 'Â¿Te pasas la vida preguntÃ¡ndole a Dios quÃ© hacer sin obtener respuesta? QuizÃ¡s el problema no es Su silencio, sino nuestra falta de alineaciÃ³n con Su corazÃ³n. Sebastian Franz te invita a dejar de buscar "seÃ±ales" y empezar a vivir en una obediencia radical que nace de la intimidad diaria. Â¿EstÃ¡s listo para que Su voluntad sea tu mayor deleite?',
    urlDescarga: 'Libros/ilide.info-viviendo-su-voluntad-comprimido-pr_a6f3da69c54b3a4365f6977147bca85f.pdf',
    cover: 'https://imgv2-1-f.scribdassets.com/img/document/862244702/original/935252853d/1?v=1'
  },
  {
    id: 'l16',
    titulo: 'Elimina La Prisa de Tu Vida',
    autor: 'John Ortberg',
    tema: 'Intimidad y Avivamiento',
    sinopsis: 'La prisa es el gran enemigo de la vida espiritual. Si vives corriendo pero sientes que no llegas a ningÃºn lado, Ortberg tiene un diagnÃ³stico para ti: tu alma necesita espacio para respirar. Aprende a desacelerar el ritmo para poder escuchar la voz de Dios en medio del ruido moderno. Â¿Te atreves a ser la persona mÃ¡s tranquila que conoces?',
    urlDescarga: 'Libros/ilide.info-elimina-la-prisa-de-tu-vida-pr_a1c65aaef231358ffa458487af91352f.pdf',
    cover: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR6V4GpfxV3oJdl7D4a7wT-LoK7BG_GKbAYUw&s'
  },
  {
    id: 'l17',
    titulo: 'Encontrando El Camino',
    autor: 'Edyah Barragan',
    tema: 'Relaciones y Vida PrÃ¡ctica',
    sinopsis: 'Para quienes se sienten perdidos en el laberinto de la juventud y las expectativas sociales. Edyah Barragan comparte con transparencia cÃ³mo encontrar el rumbo cuando todo parece confuso. Es un llamado a volver a la esencia, a cuidar el corazÃ³n y a caminar con propÃ³sito real. Â¿Damos el primer paso para encontrar el camino de regreso al Padre?',
    urlDescarga: 'Libros/ilide.info-encontrando-el-camino-edyah-barragan-pr_dffbaa4629ab131df513870c4b7f9672.pdf',
    cover: 'https://images.cdn2.buscalibre.com/fit-in/360x360/dd/13/dd139b72a004bdb482b208ab82c5682c.jpg'
  },
  {
    id: 'l18',
    titulo: 'Ã‰l EscogiÃ³ los Clavos',
    autor: 'Max Lucado',
    tema: 'Fundamentos y TeologÃ­a',
    sinopsis: 'Cada detalle de la cruz fue una elecciÃ³n de amor por ti. Max Lucado te invita a observar los clavos, la corona y la cruz no como tragedia, sino como el regalo mÃ¡s grande de la historia. Un libro que te recordarÃ¡ que no fuiste salvado por accidente, sino por un Dios que decidiÃ³ darlo todo para recuperarte. Â¿Dimensionas cuÃ¡nto te ama realmente?',
    urlDescarga: 'Libros/ilide.info-lucado-max-el-escogio-los-clavos-pr_5abf09a30433f4370b684ad22defc49c.pdf',
    cover: 'https://libreriaclcperu.com/_CLCPeru/images/products/original/448.jpg'
  }

];
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILIDADES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mezclar(arr) {
    const c=[...arr]; for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];} return c;
}

function obtenerAutores() {
    return [...new Set(librosData.map(l => l.autor))].sort();
}

function obtenerTemas() {
    return [...new Set(librosData.map(l => l.tema))].sort();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTADO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let autoresSeleccionados = [];
let temasSeleccionados = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function crear(libro) {
    const completado = (typeof progresoManager !== 'undefined') && progresoManager.estaCompletado(libro.id);
    const stats = window._booksStatsCache[libro.id] || { leidos: 0, descargas: 0 };
    const coverUrl = libro.cover || 'Libros/covers/default-cover.jpg';

    return `
    <div class="book-card ${completado ? 'completed' : ''}" data-id="${libro.id}">
        ${completado ? '<div class="completed-badge">âœ“</div>' : ''}

        <div class="book-cover-wrapper">
            <span class="book-theme">${libro.tema}</span>

            <div class="book-stats" aria-hidden="true">
                <i class="fa-solid fa-eye"></i>
                <span class="book-stat-number" id="leidos-${libro.id}">${stats.leidos}</span>
                <i class="fa-solid fa-download" style="margin-left: 6px;"></i>
                <span class="book-stat-number" id="descargas-${libro.id}">${stats.descargas}</span>
            </div>

            <div class="book-3d" aria-hidden="true">
    <!-- Contraportada (fondo) -->
    <div class="book-back-cover"></div>
    
    <!-- Lomo -->
    <div class="book-spine" data-title="${libro.titulo}"></div>
    
    <!-- Portada visible (ESTADO INICIAL) -->
    <div class="book-cover-art" 
         role="img" 
         aria-label="Portada ${libro.titulo}"
         style="background-image: url('${coverUrl}');"></div>
    

    
    <!-- Tapa frontal que se cierra (visible al hover) -->
    <div class="book-front-cover">
        <div class="book-icon">ğŸ“–</div>
        <div class="book-title-cover">${libro.titulo}</div>
        <div class="book-author-cover">${libro.autor}</div>
    </div>
</div>
        </div>

        <div class="book-info">
            <h3 class="book-title">${libro.titulo}</h3>
            <p class="book-author">por ${libro.autor}</p>
            <p class="book-synopsis">${libro.sinopsis}</p>

            <div class="book-actions">
                <button class="book-btn btn-download" data-id="${libro.id}">
                    <i class="fa-solid fa-download"></i> Descargar
                </button>
                <button class="book-btn btn-info" data-id="${libro.id}">
                    <i class="fa-solid fa-circle-info"></i> Leer mÃ¡s
                </button>
            </div>

            <div class="checkbox-wrapper-book">
                <input type="checkbox" id="${libro.id}" ${completado ? 'checked' : ''}>
                <label for="${libro.id}">
                    ${completado ? 'âœ“ LeÃ­do' : 'Marcar como leÃ­do'}
                </label>
            </div>
        </div>
    </div>`;
}

function render() {
    const g = document.getElementById('libros-grid');
    const r = document.getElementById('results-count');
    
    let f = librosData.filter(libro => {
        const autoresOk = autoresSeleccionados.length === 0 || autoresSeleccionados.includes(libro.autor);
        const temasOk = temasSeleccionados.length === 0 || temasSeleccionados.includes(libro.tema);
        return autoresOk && temasOk;
    });
    
    const nc = f.filter(l => !progresoManager.estaCompletado(l.id));
    const co = f.filter(l => progresoManager.estaCompletado(l.id));
    
    const sortType = document.getElementById('sort-select')?.value || 'default';
    
    if (sortType === 'most-read') {
        nc.sort((a, b) => {
            const statsA = window._booksStatsCache[a.id] || { leidos: 0 };
            const statsB = window._booksStatsCache[b.id] || { leidos: 0 };
            return statsB.leidos - statsA.leidos;
        });
        co.sort((a, b) => {
            const statsA = window._booksStatsCache[a.id] || { leidos: 0 };
            const statsB = window._booksStatsCache[b.id] || { leidos: 0 };
            return statsB.leidos - statsA.leidos;
        });
    } else if (sortType === 'most-downloaded') {
        nc.sort((a, b) => {
            const statsA = window._booksStatsCache[a.id] || { descargas: 0 };
            const statsB = window._booksStatsCache[b.id] || { descargas: 0 };
            return statsB.descargas - statsA.descargas;
        });
        co.sort((a, b) => {
            const statsA = window._booksStatsCache[a.id] || { descargas: 0 };
            const statsB = window._booksStatsCache[b.id] || { descargas: 0 };
            return statsB.descargas - statsA.descargas;
        });
    } else {
        nc.splice(0, nc.length, ...mezclar(nc));
        co.splice(0, co.length, ...mezclar(co));
    }
    
    f = [...nc, ...co];
    
    if (!f.length) {
        g.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:3rem;">No se encontraron libros</p>';
        r.textContent = '';
    } else {
        g.innerHTML = f.map(crear).join('');
        r.textContent = `${f.length} libro${f.length !== 1 ? 's' : ''} disponible${f.length !== 1 ? 's' : ''}`;
        
        // Event listeners
        g.querySelectorAll('.checkbox-wrapper-book input').forEach(cb => {
            cb.addEventListener('change', async (e) => {
                const card = e.target.closest('.book-card');
                const libroId = card.dataset.id;
                const libro = librosData.find(l => l.id === libroId);
                const label = e.target.nextElementSibling;
                
                if (e.target.checked) {
                    if (progresoManager.marcarCompletado(libroId, libro.titulo, 'libros')) {
                        card.classList.add('completed');
                        label.textContent = 'âœ“ LeÃ­do';
                        if (!card.querySelector('.completed-badge')) {
                            card.insertAdjacentHTML('afterbegin', '<div class="completed-badge">âœ“</div>');
                        }
                        mostrarNotificacion('Â¡Libro marcado como leÃ­do! ğŸ“š');
                        if (typeof window.registrarLectura === 'function') {
                            await window.registrarLectura(libroId);
                        }
                        setTimeout(() => render(), 100);
                    }
                } else {
                    if (progresoManager.desmarcarCompletado(libroId)) {
                        card.classList.remove('completed');
                        label.textContent = 'Marcar como leÃ­do';
                        const badge = card.querySelector('.completed-badge');
                        if (badge) badge.remove();
                        mostrarNotificacion('Libro desmarcado');

                        // <-- AÃ±ade esto para decrementar contador en Firestore
                        if (typeof window.desregistrarLectura === 'function') {
                            await window.desregistrarLectura(libroId);
                        }

                        setTimeout(() => render(), 100);
                    }
                }
            });
        });
        
        g.querySelectorAll('.btn-download').forEach(btn => {
    btn.addEventListener('click', async () => {
        const libroId = btn.dataset.id;
        const libro = librosData.find(l => l.id === libroId);

        if (!libro || !libro.urlDescarga || libro.urlDescarga === '#') {
            mostrarNotificacion('âŒ Archivo no disponible');
            return;
        }

        // Registrar descarga en Firebase
        if (typeof window.registrarDescargaLibro === 'function') {
            await window.registrarDescargaLibro(libroId);
        }

        // Forzar descarga real
        const link = document.createElement('a');
        link.href = libro.urlDescarga;
        link.download = '';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        mostrarNotificacion('ğŸ“¥ Descargando libro...');
    });
});
        
        g.querySelectorAll('.btn-info').forEach(btn => {
            btn.addEventListener('click', () => {
                const libroId = btn.dataset.id;
                const libro = librosData.find(l => l.id === libroId);
                if (libro) {
                    document.getElementById('modal-title').textContent = libro.titulo;
                    document.getElementById('modal-author').textContent = `por ${libro.autor}`;
                    document.getElementById('modal-synopsis-text').textContent = libro.sinopsis;
                    document.getElementById('modal-synopsis').classList.add('show');
                }
            });
        });
    }
    
    actualizarChips();
    actualizarTextoBotones();
}


// Llama a esto despuÃ©s de render()

function cargarEstadisticas(libroId) {
    if (typeof window.escucharCambiosLibro === 'function') {
        window.escucharCambiosLibro(libroId, (stats) => {
            const leidosEl = document.getElementById(`leidos-${libroId}`);
            const descargasEl = document.getElementById(`descargas-${libroId}`);
            if (leidosEl) leidosEl.textContent = stats.leidos;
            if (descargasEl) descargasEl.textContent = stats.descargas;
        });
    }
}

function actualizarChips() {
    const c = document.getElementById('active-filters');
    c.innerHTML = '';
    
    autoresSeleccionados.forEach(a => {
        const ch = document.createElement('div');
        ch.className = 'filter-chip';
        ch.innerHTML = `<span>Autor: ${a}</span><span class="filter-chip-close" data-tipo="autor" data-valor="${a}">Ã—</span>`;
        c.appendChild(ch);
    });
    
    temasSeleccionados.forEach(t => {
        const ch = document.createElement('div');
        ch.className = 'filter-chip';
        ch.innerHTML = `<span>Tema: ${t}</span><span class="filter-chip-close" data-tipo="tema" data-valor="${t}">Ã—</span>`;
        c.appendChild(ch);
    });
    
    c.querySelectorAll('.filter-chip-close').forEach(btn => {
        btn.addEventListener('click', () => {
            const t = btn.dataset.tipo;
            const v = btn.dataset.valor;
            if (t === 'autor') {
                autoresSeleccionados = autoresSeleccionados.filter(x => x !== v);
                renderAutores();
            } else if (t === 'tema') {
                temasSeleccionados = temasSeleccionados.filter(x => x !== v);
                renderTemas();
            }
            render();
        });
    });
}

function renderAutores() {
    const menu = document.getElementById('autor-menu');
    const autores = obtenerAutores();
    menu.innerHTML = autores.map(a => `
        <div class="filter-option ${autoresSeleccionados.includes(a)?'selected':''}" data-valor="${a}">
            <input type="checkbox" id="aut-${a.replace(/\s+/g,'-')}" ${autoresSeleccionados.includes(a)?'checked':''}>
            <label for="aut-${a.replace(/\s+/g,'-')}">${a}</label>
        </div>
    `).join('');
    
    menu.querySelectorAll('.filter-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;
            const checkbox = opt.querySelector('input');
            checkbox.checked = !checkbox.checked;
            toggleAutor(opt.dataset.valor);
        });
        opt.querySelector('input').addEventListener('change', (e) => {
            e.stopPropagation();
            toggleAutor(opt.dataset.valor);
        });
    });
}

function renderTemas() {
    const menu = document.getElementById('tema-menu');
    const temas = obtenerTemas();
    menu.innerHTML = temas.map(t => `
        <div class="filter-option ${temasSeleccionados.includes(t)?'selected':''}" data-valor="${t}">
            <input type="checkbox" id="tem-${t.replace(/\s+/g,'-')}" ${temasSeleccionados.includes(t)?'checked':''}>
            <label for="tem-${t.replace(/\s+/g,'-')}">${t}</label>
        </div>
    `).join('');
    
    menu.querySelectorAll('.filter-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
            if (e.target.tagName === 'INPUT') return;
            const checkbox = opt.querySelector('input');
            checkbox.checked = !checkbox.checked;
            toggleTema(opt.dataset.valor);
        });
        opt.querySelector('input').addEventListener('change', (e) => {
            e.stopPropagation();
            toggleTema(opt.dataset.valor);
        });
    });
}

function toggleAutor(a) {
    if (autoresSeleccionados.includes(a)) {
        autoresSeleccionados = autoresSeleccionados.filter(x => x !== a);
    } else {
        autoresSeleccionados.push(a);
    }
    renderAutores();
    render();
}

function toggleTema(t) {
    if (temasSeleccionados.includes(t)) {
        temasSeleccionados = temasSeleccionados.filter(x => x !== t);
    } else {
        temasSeleccionados.push(t);
    }
    renderTemas();
    render();
}

function actualizarTextoBotones() {
    const autorBtn = document.getElementById('autor-toggle');
    const temaBtn = document.getElementById('tema-toggle');
    
    if (autoresSeleccionados.length === 0) {
        autorBtn.textContent = 'Autor (todos)';
    } else if (autoresSeleccionados.length === 1) {
        autorBtn.textContent = `Autor: ${autoresSeleccionados[0]}`;
    } else {
        autorBtn.textContent = `Autor (${autoresSeleccionados.length})`;
    }
    
    if (temasSeleccionados.length === 0) {
        temaBtn.textContent = 'Tema (todos)';
    } else if (temasSeleccionados.length === 1) {
        temaBtn.textContent = `Tema: ${temasSeleccionados[0]}`;
    } else {
        temaBtn.textContent = `Tema (${temasSeleccionados.length})`;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
    if (typeof guardarConteoCategoria === 'function') {
        guardarConteoCategoria('libros', librosData.length);
    }
    
    renderAutores();
    renderTemas();
    render();
    
    librosData.forEach(libro => cargarEstadisticas(libro.id));
    
    document.getElementById('autor-toggle').addEventListener('click', () => {
        const menu = document.getElementById('autor-menu');
        const btn = document.getElementById('autor-toggle');
        menu.classList.toggle('show');
        btn.classList.toggle('active');
        document.getElementById('tema-menu').classList.remove('show');
        document.getElementById('tema-toggle').classList.remove('active');
    });
    
    document.getElementById('tema-toggle').addEventListener('click', () => {
        const menu = document.getElementById('tema-menu');
        const btn = document.getElementById('tema-toggle');
        menu.classList.toggle('show');
        btn.classList.toggle('active');
        document.getElementById('autor-menu').classList.remove('show');
        document.getElementById('autor-toggle').classList.remove('active');
    });
    
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.filter-dropdown')) {
            document.querySelectorAll('.filter-menu').forEach(m => m.classList.remove('show'));
            document.querySelectorAll('.filter-btn-toggle').forEach(b => b.classList.remove('active'));
        }
    });
    
    document.getElementById('sort-select').addEventListener('change', () => {
        render();
    });
    
    document.getElementById('modal-close').addEventListener('click', () => {
        document.getElementById('modal-synopsis').classList.remove('show');
    });
    
    document.getElementById('modal-synopsis').addEventListener('click', (e) => {
        if (e.target.id === 'modal-synopsis') {
            document.getElementById('modal-synopsis').classList.remove('show');
        }
    });
    
    if (typeof iniciarScrollHeader === 'function') iniciarScrollHeader();
});
    </script>
</body>
</html>